<!DOCTYPE html>
<!-- saved from url=(0110)http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/ -->
<html lang="en-US" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" type="text/css" href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/M9BPzEspys9MycgsS40vM9Iz1S8uqcxJBQA.css" media="all"><meta charset="UTF-8"><title>Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/css" rel="stylesheet" type="text/css"><link href="http://www.androidhive.info/wp-content/themes/androidhive_v2.5/img/favicon.ico?a942c6" rel="shortcut icon" type="image/x-icon"><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.androidhive.info/feed/"><link rel="alternate" type="text/xml" title="RSS .92" href="http://www.androidhive.info/feed/rss/"><link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://www.androidhive.info/feed/atom/"><link href="http://www.androidhive.info/wp-content/themes/androidhive_v2.5/img/favicon.ico?a942c6" rel="shortcut icon" type="image/x-icon"><link rel="pingback" href="http://www.androidhive.info/xmlrpc.php"><link rel="me" href="https://plus.google.com/108738908574182577919/about"><link rel="alternate" type="application/rss+xml" title="AndroidHive | Tutorials, Games, Apps, Tips » Feed" href="http://www.androidhive.info/feed/"><link rel="alternate" type="application/rss+xml" title="AndroidHive | Tutorials, Games, Apps, Tips » Comments Feed" href="http://www.androidhive.info/comments/feed/"><link rel="alternate" type="application/rss+xml" title="AndroidHive | Tutorials, Games, Apps, Tips » Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL Comments Feed" href="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/feed/"><script type="text/javascript" async="" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/pinit_main.js"></script><script type="text/javascript" async="" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/plusone.js" gapi_processed="true"></script><script id="facebook-jssdk" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/all.js"></script><script src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/cb=gapi.loaded_1" async=""></script><script src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/plusone.js" gapi_processed="true"></script><script type="text/javascript" async="" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/ga.js"></script><script type="text/javascript" async="" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/cse.js"></script><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/M9bPKixNLarUMYYydHMz04sSS1L1cjPzAA.js"></script><link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.androidhive.info/xmlrpc.php?rsd"><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.androidhive.info/wp-includes/wlwmanifest.xml"><link rel="prev" title="Android Twitter oAuth Connect Tutorial" href="http://www.androidhive.info/2012/09/android-twitter-oauth-connect-tutorial/"><link rel="next" title="Android Multilevel ListView Tutorial" href="http://www.androidhive.info/2012/10/android-multilevel-listview-tutorial/"><meta name="generator" content="WordPress 3.9.1"><link rel="shortlink" href="http://www.androidhive.info/?p=2171"><script type="text/javascript">
	window._wp_rp_static_base_url = 'https://wprpp.s3.amazonaws.com/static/';
	window._wp_rp_wp_ajax_url = "http://www.androidhive.info/wp-admin/admin-ajax.php";
	window._wp_rp_plugin_version = '3.4';
	window._wp_rp_post_id = '2171';
	window._wp_rp_num_rel_posts = '4';
	window._wp_rp_blog_id = '8596021';
	window._wp_rp_thumbnails = true;
	window._wp_rp_post_title = 'Android+Push+Notifications+using+Google+Cloud+Messaging+%28GCM%29%2C+PHP+and+MySQL';
	window._wp_rp_post_tags = ['intermediate', 'mysql', 'php', 'gcm', 'google', 'batteri', 'tutori', 'servic', 'fashion', 'data', 'cloud', 'android', 'illustr', 'server', 'php', 'applic', 'code', 'mysql', 'apach', 'googl'];
	window._wp_rp_remote_recommendations = false;
	window._wp_rp_promoted_content = true;
	window._wp_rp_traffic_exchange = true;
</script><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/loader.js" async=""></script><link rel="stylesheet" href="http://www.androidhive.info/wp-content/plugins/wordpress-23-related-posts-plugin/static/themes/vertical.css?version=3.4&a942c6"><style type="text/css">.related_post_title{}ul.related_post{}ul.related_post li{}ul.related_post li a{}ul.related_post li img{}</style><script type="text/javascript">
/* <![CDATA[ */
jQuery.ajax({type:'GET',url:'http://www.androidhive.info/wp-admin/admin-ajax.php',data:'postviews_id=2171&action=postviews',cache:false});/* ]]> */
</script><meta name="description" content="Android tutorial about integrating Google Cloud Messaging in your android application using php, mysql."><meta name="keywords" content="android gcm, google cloud messaging,  android google cloud messaging, google gcm, gcm php, gcm php mysql"><link rel="canonical" href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL.html"><link rel="stylesheet" type="text/css" href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/shCore.css"><link rel="stylesheet" type="text/css" href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/shThemeDefault.css"><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.5"><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/LchRCoAgDADQC8WmQueJlUMn6kpJ6vZB-PkeIiV6IKiGzHRKh0PLf5hl75ium9uLFqwBNwVFKqS-GKTqm4qPMngbDlaMTJ7bBw.js"></script><script async="" type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/count.js"></script><script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-24602371-1']);
            _gaq.push(['_setDomainName', 'androidhive.info']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script');
                ga.type = 'text/javascript';
                ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
            })();
        </script><script async="" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/count-data.js"></script><script src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/jsapi" type="text/javascript"></script><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/saved_resource"></script><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/saved_resource(1)"></script><link type="text/css" href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/default+en.css" rel="stylesheet"><link type="text/css" href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/default.css" rel="stylesheet"><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/default+en.I.js"></script><style type="text/css">
.gsc-control-cse {
font-family: Arial, sans-serif;
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-control-cse .gsc-table-result {
font-family: Arial, sans-serif;
}
input.gsc-input, .gsc-input-box, .gsc-input-box-hover, .gsc-input-box-focus {
border-color: #D9D9D9;
}
input.gsc-search-button, input.gsc-search-button:hover, input.gsc-search-button:focus {
border-color: #2F5BB7;
background-color: #357AE8;
background-image: none;
filter: none;
}
.gsc-tabHeader.gsc-tabhInactive {
border-color: #CCCCCC;
background-color: #FFFFFF;
}
.gsc-tabHeader.gsc-tabhActive {
border-color: #CCCCCC;
border-bottom-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-tabsArea {
border-color: #CCCCCC;
}
.gsc-webResult.gsc-result,
.gsc-results .gsc-imageResult {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-webResult.gsc-result:hover,
.gsc-imageResult:hover {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gs-webResult.gs-result a.gs-title:link,
.gs-webResult.gs-result a.gs-title:link b,
.gs-imageResult a.gs-title:link,
.gs-imageResult a.gs-title:link b {
color: #1155CC;
}
.gs-webResult.gs-result a.gs-title:visited,
.gs-webResult.gs-result a.gs-title:visited b,
.gs-imageResult a.gs-title:visited,
.gs-imageResult a.gs-title:visited b {
color: #000000;
}
.gs-webResult.gs-result a.gs-title:hover,
.gs-webResult.gs-result a.gs-title:hover b,
.gs-imageResult a.gs-title:hover,
.gs-imageResult a.gs-title:hover b {
color: #274E13;
}
.gs-webResult.gs-result a.gs-title:active,
.gs-webResult.gs-result a.gs-title:active b,
.gs-imageResult a.gs-title:active,
.gs-imageResult a.gs-title:active b {
color: #1155CC;
}
.gsc-cursor-page {
color: #1155CC;
}
a.gsc-trailing-more-results:link {
color: #1155CC;
}
.gs-webResult .gs-snippet,
.gs-imageResult .gs-snippet,
.gs-fileFormatType {
color: #666666;
}
.gs-webResult div.gs-visibleUrl,
.gs-imageResult div.gs-visibleUrl {
color: #6AA84F;
}
.gs-webResult div.gs-visibleUrl-short {
color: #6AA84F;
}
.gs-webResult div.gs-visibleUrl-short {
display: none;
}
.gs-webResult div.gs-visibleUrl-long {
display: block;
}
.gs-promotion div.gs-visibleUrl-short {
display: none;
}
.gs-promotion div.gs-visibleUrl-long {
display: block;
}
.gsc-cursor-box {
border-color: #FFFFFF;
}
.gsc-results .gsc-cursor-box .gsc-cursor-page {
border-color: #CCCCCC;
background-color: #FFFFFF;
color: #1155CC;
}
.gsc-results .gsc-cursor-box .gsc-cursor-current-page {
border-color: #CCCCCC;
background-color: #FFFFFF;
color: #000000;
}
.gsc-webResult.gsc-result.gsc-promotion {
border-color: #F6F6F6;
background-color: #F3F3F3;
}
.gsc-completion-title {
color: #1155CC;
}
.gsc-completion-snippet {
color: #666666;
}
.gs-promotion a.gs-title:link,
.gs-promotion a.gs-title:link *,
.gs-promotion .gs-snippet a:link {
color: #1155CC;
}
.gs-promotion a.gs-title:visited,
.gs-promotion a.gs-title:visited *,
.gs-promotion .gs-snippet a:visited {
color: #1155CC;
}
.gs-promotion a.gs-title:hover,
.gs-promotion a.gs-title:hover *,
.gs-promotion .gs-snippet a:hover {
color: #1155CC;
}
.gs-promotion a.gs-title:active,
.gs-promotion a.gs-title:active *,
.gs-promotion .gs-snippet a:active {
color: #1155CC;
}
.gs-promotion .gs-snippet,
.gs-promotion .gs-title .gs-promotion-title-right,
.gs-promotion .gs-title .gs-promotion-title-right * {
color: #333333;
}
.gs-promotion .gs-visibleUrl,
.gs-promotion .gs-visibleUrl-short {
color: #009933;
}
</style><script type="text/javascript" async="" src="http://s3.buysellads.com/ac/bsa.js"></script><script type="text/javascript" async="" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/embed.js"></script></head><body class="body" style="opacity: 1;"> <header class="header clear" role="banner"><div class="wrapper relative"><div class="logo"> <a href="http://www.androidhive.info/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Logo&#39;, &#39;Click&#39;, &#39;Home Logo&#39;]);"><img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/logo.png" alt="androidhive"></a></div><div class="nav"> <nav class="nav_top" role="navigation"><div class="profile"><ul id="social_icons"><li class="f"><div class="hover"></div><a href="http://www.facebook.com/ravi8x" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Social&#39;, &#39;Click&#39;, &#39;Home | Facebook&#39;]);"></a></li><li class="t"><div class="hover"></div><a href="http://www.twitter.com/ravitamada" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Social&#39;, &#39;Click&#39;, &#39;Home | Twitter&#39;]);"></a></li><li class="g"><div class="hover"></div><a href="https://plus.google.com/u/0/108738908574182577919/posts" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Social&#39;, &#39;Click&#39;, &#39;Home | GPlus&#39;]);"></a></li><li class="y"><div class="hover"></div><a href="http://www.youtube.com/androidhive" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Social&#39;, &#39;Click&#39;, &#39;Home | Youtube&#39;]);"></a></li><li class="s" isshown="false"><div class="hover"></div><a href="" onclick="return false;"></a></li></ul></div><ul><li><a href="http://tips.androidhive.info/" title="Android Quick Code Hints" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Top Navigation&#39;, &#39;Click&#39;, &#39;Tips | Home Page&#39;]);">TIPS</a></li><li><a href="http://download.androidhive.info/" title="Android Cource Codes" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Top Navigation&#39;, &#39;Click&#39;, &#39;Download | Home Page&#39;]);">DOWNLOAD</a></li><li><a href="http://design.androidhive.info/" title="Android Design Inspiration" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Top Navigation&#39;, &#39;Click&#39;, &#39;Design | Home Page&#39;]);">DESIGN</a></li></ul></nav></div><div class="clear"></div></div> </header><div class="header_search"><div class="wrapper relative header_search_box hide"><form role="search" method="get" action="http://www.androidhive.info/search/" onsubmit="_gaq.push([&#39;_trackEvent&#39;, &#39;Inside Search&#39;, &#39;Click&#39;, $(&#39;.input_search_inside&#39;).val()]);"><div id="search_input_container"> <input type="text" id="q" name="q" class="input_search_inside" placeholder="Enter your search keyword" value=""> <input type="submit" value="Search" class="btn_search_inside"><div class="clear"></div></div></form></div></div><div class="search_body_overlay"></div><div class="wrapper aligncenter"><div id="ad_top"><div id="bsap_1289782" class="bsarocks bsap_7c32e89b651d1c540f683de3e98dc4a3"></div></div><div class="clear"></div></div><div class="wrapper container" id="container"><section class="content" role="main"> <article class="article"><h2><a href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL.html" title="Click to read Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL" rel="bookmark">Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL</a></h2><div class="article_meta"><ul class="ul"><li class="first"><a href="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/#disqus_thread"><b>1024</b> Comments</a> . By <a href="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/#" class="author">Ravi Tamada</a>on 14th, Oct 2012 - 07:36 PM</li><li><div class="fb-like" data-href="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/" data-width="90" data-layout="button_count" data-show-faces="false" data-send="false"></div></li><li><div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 90px; height: 20px; background: transparent;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 90px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" tabindex="0" vspace="0" width="100%" id="I9_1417634474324" name="I9_1417634474324" src="https://apis.google.com/u/0/se/0/_/+1/fastbutton?usegapi=1&size=medium&annotation=bubble&width=90&origin=http%3A%2F%2Fwww.androidhive.info&url=http%3A%2F%2Fwww.androidhive.info%2F2012%2F10%2Fandroid-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql%2F&gsrc=3p&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.9dmnkW-MRCY.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Ft%3Dzcms%2Frs%3DAGLTcCNObFXjcdbTARBNd_5lJHslLoaIfw#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&id=I9_1417634474324&parent=http%3A%2F%2Fwww.androidhive.info&pfname=&rpctoken=10116130" data-gapiattached="true" title="+1"></iframe></div></li><li><a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/" data-count="horizontal" data-via="RaviTamada #Androidhive" data-text="#Android Push Notifications using #Google Cloud Messaging (GCM), #PHP and #MySQL">Tweet</a></li></ul></div><div id="ad_inside_320_250"><div id="bsap_1289784" class="bsarocks bsap_7c32e89b651d1c540f683de3e98dc4a3"></div></div><p>As per google’s documentation “Google Cloud Messaging for Android (GCM) is a service that helps developers send data from servers to their Android applications on Android devices”. Using this service you can send data to your application whenever new data is available instead of making requests to server in timely fashion. Integrating GCM in your android application enhances user experience and saves lot of battery power.</p><div class="downloadsection"><a href="http://download.androidhive.info/download?code=iS5bX74qeLC9BJzKIwhYnSHv0vziNeO5we85USk3IGtj6%2Faczubg6fCH0vmiw9zHaMdsR5SffC%2Fre3MUd93rM%2Blp8F6fqJjFS%2B%2FniItFlnA551qjzzUItsLnCQCb%2Fzs0N8P%2FUOajn7DlOMPdl89grMIWwlyHPNtyzcfvHOlovZ8nAeR51mOro7aUYBA51MKIvxruyT" target="_blank"><img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/download_btn.png" alt="Download Code" title="Download Code" width="173" height="41" class="alignnone size-full wp-image-423"></a></div><div class="downloadsection"> <iframe src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/4DLPlpVqtWk.html" frameborder="0" allowfullscreen="" style="width: 719px; height: 424.525423728814px;"></iframe></div><p><br></p><h3>Overview of Google Cloud Messaging, PHP and MySQL</h3><p>In this tutorial i used <em>PHP</em> as server side programming language and <em>MySQL</em> as server side database. I installed WAMP server to install php, mysql, apache for me. If you are new to connecting PHP, MySQL to android application, i suggest you go through this tutorial<br> <a href="http://www.androidhive.info/2012/05/how-to-connect-android-with-php-mysql/" target="_blank" class="ref-link">How to connect Android with PHP, MySQL</a></p><p>You can go through the <a href="http://developer.android.com/guide/google/gcm/index.html" target="_blank" class="ref-link">official documentation</a> if you want to know more about GCM.</p><p>The following diagram is illustrating the overview of the tutorial and the purpose of each entity involved in this tutorial.</p><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/gcm-a-modr.png" alt="android google cloud messaging gcm architecture" title="android google cloud messaging gcm architecture" width="720px" height="auto" class="alignnone size-full wp-image-2458"></div><p><br></p><h3>Registering with Google Cloud Messaging</h3><p><strong>1</strong>. Goto <a href="https://code.google.com/apis/console" class="ref-link" target="_blank">Google APIs Console page</a> and create a new project. (If you haven’t created already otherwise it will take you to dashboard)</p><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/gcm_create_project.png" alt="android gcm registering in google api console" title="android gcm registering in google api console" width="720px" height="auto" class="alignnone size-full wp-image-2291"></div><p><strong>2</strong>. After creating project you can see the <strong>project id in the url</strong>. Note down the project id which will be used as <em>SENDER ID</em> in android project. (Example: in #project:460866929976 after semicolon 460866929976 is the sender id)</p><div><div id="highlighter_874987" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain"><a href="https://code.google.com/apis/console/">https://code.google.com/apis/console/</a>#project:460866929976</code></div></div></td></tr></tbody></table></div></div><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/gcm_sender_id.png" alt="android gcm sender id" title="android gcm sender id" width="720px" height="auto" class="alignnone size-full wp-image-2300"></div><p><strong>3</strong>. After that click on <em>Services</em> on the left panel and turn on <em>Google Cloud Messaging for Android</em>.</p><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/gcm_enable_service.png" alt="android gcm google api console" title="android gcm google api console" width="720px" height="auto" class="alignnone size-full wp-image-2306"></div><p><strong>4</strong>. Once you are done, click on API Access and note down the <em>API Key</em>. This API key will be used when sending requests to GCM server.</p><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/gcm_api_key.png" alt="android google api key" title="android google api key" width="720px" height="auto" class="alignnone size-full wp-image-2310"></div><p><br></p><h3>Creating MySQL Database</h3><p><strong>1</strong>. Open phpmyadmin panel by going to <em>http://localhost/phpmyadmin</em> and create a database called <em>gcm</em>. (if your localhost is running on port number add port number to url)<br> <strong>2</strong>. After creating the database, select the database and execute following query in SQL tab to create <strong>gcm_users</strong> table.</p><div><div id="highlighter_647214" class="syntaxhighlighter nogutter  sql"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">IF </code><code class="sql color1">NOT</code> <code class="sql plain">EXISTS `gcm_users` (</code></div><div class="line number2 index1 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`id` </code><code class="sql keyword">int</code><code class="sql plain">(11) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql plain">AUTO_INCREMENT,</code></div><div class="line number3 index2 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`gcm_regid` text,</code></div><div class="line number4 index3 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`</code><code class="sql keyword">name</code><code class="sql plain">` </code><code class="sql keyword">varchar</code><code class="sql plain">(50) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number5 index4 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`email` </code><code class="sql keyword">varchar</code><code class="sql plain">(255) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number6 index5 alt1"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql plain">`created_at` </code><code class="sql keyword">timestamp</code> <code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql keyword">DEFAULT</code> <code class="sql color2">CURRENT_TIMESTAMP</code><code class="sql plain">,</code></div><div class="line number7 index6 alt2"><code class="sql spaces">&nbsp;&nbsp;</code><code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code> <code class="sql plain">(`id`)</code></div><div class="line number8 index7 alt1"><code class="sql plain">) ENGINE=InnoDB </code><code class="sql keyword">DEFAULT</code> <code class="sql plain">CHARSET=latin1 AUTO_INCREMENT=1 ;</code></div></div></td></tr></tbody></table></div></div><p>Check the following video to know about creating database and php project.<br> <br></p><h3>Creating &amp; Running the PHP Project</h3><p>When we are making request to GCM server using PHP i used curl to make post request. Before creating php project enable curl module in your php extensions.<br> Left Click on the WAMP icon the system try -&gt; <em>PHP</em> -&gt; <em>PHP Extensions</em> -&gt; Enable <em>php_curl</em></p><p><strong>1</strong>. Goto your <strong>WAMP</strong> folder and inside <em>www</em> folder create a folder called <strong>gcm_server_php</strong>. (In my case i installed wamp in C:\WAMP)<br> <strong>2</strong>. Create a filed called <em>config.php</em> This fill holds the database configuration and google api key.</p><div><div id="highlighter_557677" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><caption>config.php</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php comments">/**</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;</code><code class="php comments">* Database config variables</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;</code><code class="php comments">*/</code></div><div class="line number5 index4 alt2"><code class="php plain">define(</code><code class="php string">"DB_HOST"</code><code class="php plain">, </code><code class="php string">"localhost"</code><code class="php plain">);</code></div><div class="line number6 index5 alt1"><code class="php plain">define(</code><code class="php string">"DB_USER"</code><code class="php plain">, </code><code class="php string">"root"</code><code class="php plain">);</code></div><div class="line number7 index6 alt2"><code class="php plain">define(</code><code class="php string">"DB_PASSWORD"</code><code class="php plain">, </code><code class="php string">"root"</code><code class="php plain">);</code></div><div class="line number8 index7 alt1"><code class="php plain">define(</code><code class="php string">"DB_DATABASE"</code><code class="php plain">, </code><code class="php string">"gcm"</code><code class="php plain">);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php comments">/*</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;</code><code class="php comments">* Google API Key</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;</code><code class="php comments">*/</code></div><div class="line number13 index12 alt2"><code class="php plain">define(</code><code class="php string">"GOOGLE_API_KEY"</code><code class="php plain">, </code><code class="php string">"BIzaSyCRLa4LQZWNQBcRCYcIVYA45i9i8zfClqc"</code><code class="php plain">); </code><code class="php comments">// Place your Google API Key</code></div><div class="line number14 index13 alt1"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>3</strong>. Create another file called <em>db_connect.php</em> This file handles database connections, mainly opens and closes connection.</p><div><div id="highlighter_355791" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><caption>db_connect.php</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="php keyword">class</code> <code class="php plain">DB_Connect {</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// constructor</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">function</code> <code class="php plain">__construct() {</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// destructor</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">function</code> <code class="php plain">__destruct() {</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// $this-&gt;close();</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;</code>&nbsp;</div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Connecting to database</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">connect() {</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">require_once</code> <code class="php string">'config.php'</code><code class="php plain">;</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// connecting to mysql</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$con</code> <code class="php plain">= mysql_connect(DB_HOST, DB_USER, DB_PASSWORD);</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// selecting database</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">mysql_select_db(DB_DATABASE);</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;</code>&nbsp;</div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// return database handler</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$con</code><code class="php plain">;</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;</code>&nbsp;</div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Closing database connection</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">close() {</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">mysql_close();</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;</code>&nbsp;</div><div class="line number32 index31 alt1"><code class="php plain">} </code></div><div class="line number33 index32 alt2"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>4</strong>. Create a new file named <em>db_functions.php</em> This file contains function to perform database CRUD operations. But i wrote function for creating user only.</p><div><div id="highlighter_491258" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><caption>db_functions.php</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="php keyword">class</code> <code class="php plain">DB_Functions {</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">private</code> <code class="php variable">$db</code><code class="php plain">;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//put your code here</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// constructor</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">function</code> <code class="php plain">__construct() {</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">include_once</code> <code class="php string">'./db_connect.php'</code><code class="php plain">;</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// connecting to database</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;db = </code><code class="php keyword">new</code> <code class="php plain">DB_Connect();</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$this</code><code class="php plain">-&gt;db-&gt;connect();</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// destructor</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">function</code> <code class="php plain">__destruct() {</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* Storing new user</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* returns user details</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">storeUser(</code><code class="php variable">$name</code><code class="php plain">, </code><code class="php variable">$email</code><code class="php plain">, </code><code class="php variable">$gcm_regid</code><code class="php plain">) {</code></div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// insert user into database</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= mysql_query(</code><code class="php string">"INSERT INTO gcm_users(name, email, gcm_regid, created_at) VALUES('$name', '$email', '$gcm_regid', NOW())"</code><code class="php plain">);</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// check for successful store</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$result</code><code class="php plain">) {</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// get user details</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$id</code> <code class="php plain">= mysql_insert_id(); </code><code class="php comments">// last inserted id</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= mysql_query(</code><code class="php string">"SELECT * FROM gcm_users WHERE id = $id"</code><code class="php plain">) </code><code class="php keyword">or</code> <code class="php keyword">die</code><code class="php plain">(mysql_error());</code></div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// return user details</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(mysql_num_rows(</code><code class="php variable">$result</code><code class="php plain">) &gt; 0) {</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">mysql_fetch_array(</code><code class="php variable">$result</code><code class="php plain">);</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number43 index42 alt2">&nbsp;</div><div class="line number44 index43 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></div><div class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* Getting all users</code></div><div class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></div><div class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">getAllUsers() {</code></div><div class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= mysql_query(</code><code class="php string">"select * FROM gcm_users"</code><code class="php plain">);</code></div><div class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php variable">$result</code><code class="php plain">;</code></div><div class="line number50 index49 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number51 index50 alt2">&nbsp;</div><div class="line number52 index51 alt1"><code class="php plain">}</code></div><div class="line number53 index52 alt2">&nbsp;</div><div class="line number54 index53 alt1"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>5</strong>. Create another file named <em>GCM.php</em> This file used to <strong>send push notification requests</strong> to GCM server.</p><div><div id="highlighter_833140" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><caption>GCM.php</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="php keyword">class</code> <code class="php plain">GCM {</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//put your code here</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// constructor</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">function</code> <code class="php plain">__construct() {</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">/**</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">* Sending Push Notification</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">*/</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">public</code> <code class="php keyword">function</code> <code class="php plain">send_notification(</code><code class="php variable">$registatoin_ids</code><code class="php plain">, </code><code class="php variable">$message</code><code class="php plain">) {</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// include config</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">include_once</code> <code class="php string">'./config.php'</code><code class="php plain">;</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Set POST variables</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$url</code> <code class="php plain">= </code><code class="php string">'<a href="https://android.googleapis.com/gcm/send">https://android.googleapis.com/gcm/send</a>'</code><code class="php plain">;</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$fields</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'registration_ids'</code> <code class="php plain">=&gt; </code><code class="php variable">$registatoin_ids</code><code class="php plain">,</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'data'</code> <code class="php plain">=&gt; </code><code class="php variable">$message</code><code class="php plain">,</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">);</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$headers</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'Authorization: key='</code> <code class="php plain">. GOOGLE_API_KEY,</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'Content-Type: application/json'</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">);</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Open connection</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$ch</code> <code class="php plain">= curl_init();</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Set the url, number of POST vars, POST data</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">, CURLOPT_URL, </code><code class="php variable">$url</code><code class="php plain">);</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">, CURLOPT_POST, true);</code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">, CURLOPT_HTTPHEADER, </code><code class="php variable">$headers</code><code class="php plain">);</code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">, CURLOPT_RETURNTRANSFER, true);</code></div><div class="line number39 index38 alt2">&nbsp;</div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Disabling SSL Certificate support temporarly</code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">, CURLOPT_SSL_VERIFYPEER, false);</code></div><div class="line number42 index41 alt1">&nbsp;</div><div class="line number43 index42 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">curl_setopt(</code><code class="php variable">$ch</code><code class="php plain">, CURLOPT_POSTFIELDS, json_encode(</code><code class="php variable">$fields</code><code class="php plain">));</code></div><div class="line number44 index43 alt1">&nbsp;</div><div class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Execute post</code></div><div class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= curl_exec(</code><code class="php variable">$ch</code><code class="php plain">);</code></div><div class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$result</code> <code class="php plain">=== FALSE) {</code></div><div class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">die</code><code class="php plain">(</code><code class="php string">'Curl failed: '</code> <code class="php plain">. curl_error(</code><code class="php variable">$ch</code><code class="php plain">));</code></div><div class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number50 index49 alt1">&nbsp;</div><div class="line number51 index50 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Close connection</code></div><div class="line number52 index51 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">curl_close(</code><code class="php variable">$ch</code><code class="php plain">);</code></div><div class="line number53 index52 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php variable">$result</code><code class="php plain">;</code></div><div class="line number54 index53 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number55 index54 alt2">&nbsp;</div><div class="line number56 index55 alt1"><code class="php plain">}</code></div><div class="line number57 index56 alt2">&nbsp;</div><div class="line number58 index57 alt1"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>6</strong>. Create a new file called <em>register.php</em> This file receives requests from android device and stores the user in the database.</p><div><div id="highlighter_919325" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><caption>register.php</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="php comments">// response json</code></div><div class="line number4 index3 alt1"><code class="php variable">$json</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">();</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="php comments">/**</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;</code><code class="php comments">* Registering a user device</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;</code><code class="php comments">* Store reg id in users table</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;</code><code class="php comments">*/</code></div><div class="line number10 index9 alt1"><code class="php keyword">if</code> <code class="php plain">(isset(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">"name"</code><code class="php plain">]) &amp;&amp; isset(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">"email"</code><code class="php plain">]) &amp;&amp; isset(</code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">"regId"</code><code class="php plain">])) {</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$name</code> <code class="php plain">= </code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">"name"</code><code class="php plain">];</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$email</code> <code class="php plain">= </code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">"email"</code><code class="php plain">];</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$gcm_regid</code> <code class="php plain">= </code><code class="php variable">$_POST</code><code class="php plain">[</code><code class="php string">"regId"</code><code class="php plain">]; </code><code class="php comments">// GCM Registration ID</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// Store user details in db</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">include_once</code> <code class="php string">'./db_functions.php'</code><code class="php plain">;</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">include_once</code> <code class="php string">'./GCM.php'</code><code class="php plain">;</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$db</code> <code class="php plain">= </code><code class="php keyword">new</code> <code class="php plain">DB_Functions();</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$gcm</code> <code class="php plain">= </code><code class="php keyword">new</code> <code class="php plain">GCM();</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$res</code> <code class="php plain">= </code><code class="php variable">$db</code><code class="php plain">-&gt;storeUser(</code><code class="php variable">$name</code><code class="php plain">, </code><code class="php variable">$email</code><code class="php plain">, </code><code class="php variable">$gcm_regid</code><code class="php plain">);</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$registatoin_ids</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php variable">$gcm_regid</code><code class="php plain">);</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">"product"</code> <code class="php plain">=&gt; </code><code class="php string">"shirt"</code><code class="php plain">);</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= </code><code class="php variable">$gcm</code><code class="php plain">-&gt;send_notification(</code><code class="php variable">$registatoin_ids</code><code class="php plain">, </code><code class="php variable">$message</code><code class="php plain">);</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php variable">$result</code><code class="php plain">;</code></div><div class="line number29 index28 alt2"><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">// user details missing</code></div><div class="line number31 index30 alt2"><code class="php plain">}</code></div><div class="line number32 index31 alt1"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>7</strong>. Create another file called <em>send_message.php</em> This file used to send pushnotification to android device by making a request to GCM server.</p><div><div id="highlighter_811756" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><caption>send_message.php</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php keyword">if</code> <code class="php plain">(isset(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">"regId"</code><code class="php plain">]) &amp;&amp; isset(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">"message"</code><code class="php plain">])) {</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$regId</code> <code class="php plain">= </code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">"regId"</code><code class="php plain">];</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">= </code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">"message"</code><code class="php plain">];</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">include_once</code> <code class="php string">'./GCM.php'</code><code class="php plain">;</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$gcm</code> <code class="php plain">= </code><code class="php keyword">new</code> <code class="php plain">GCM();</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$registatoin_ids</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php variable">$regId</code><code class="php plain">);</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$message</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">"price"</code> <code class="php plain">=&gt; </code><code class="php variable">$message</code><code class="php plain">);</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$result</code> <code class="php plain">= </code><code class="php variable">$gcm</code><code class="php plain">-&gt;send_notification(</code><code class="php variable">$registatoin_ids</code><code class="php plain">, </code><code class="php variable">$message</code><code class="php plain">);</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php variable">$result</code><code class="php plain">;</code></div><div class="line number16 index15 alt1"><code class="php plain">}</code></div><div class="line number17 index16 alt2"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>8</strong>. Finally create a file called <em>index.php</em> and paste the following code. The following code will create a simple admin panel to list all the user devices and provides a panel to send push notification to individual devices.</p><div><div id="highlighter_406464" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><caption>index.php</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;!DOCTYPE html&gt;</code></div><div class="line number2 index1 alt1"><code class="php plain">&lt;html&gt;</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;head&gt;</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;title&gt;&lt;/title&gt;</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;meta http-equiv=</code><code class="php string">"Content-Type"</code> <code class="php plain">content=</code><code class="php string">"text/html; charset=UTF-8"</code><code class="php plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;script src=</code><code class="php string">"<a href="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js</a>"</code><code class="php plain">&gt;&lt;/script&gt;</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;script type=</code><code class="php string">"text/javascript"</code><code class="php plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">$(document).ready(</code><code class="php keyword">function</code><code class="php plain">(){</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">});</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">function</code> <code class="php plain">sendPushNotification(id){</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">var</code> <code class="php plain">data = $(</code><code class="php string">'form#'</code><code class="php plain">+id).serialize();</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">$(</code><code class="php string">'form#'</code><code class="php plain">+id).unbind(</code><code class="php string">'submit'</code><code class="php plain">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">$.ajax({</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">url: </code><code class="php string">"send_message.php"</code><code class="php plain">,</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">type: </code><code class="php string">'GET'</code><code class="php plain">,</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">data: data,</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">beforeSend: </code><code class="php keyword">function</code><code class="php plain">() {</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">},</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">success: </code><code class="php keyword">function</code><code class="php plain">(data, textStatus, xhr) {</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">$(</code><code class="php string">'.txt_message'</code><code class="php plain">).val(</code><code class="php string">""</code><code class="php plain">);</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">},</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">error: </code><code class="php keyword">function</code><code class="php plain">(xhr, textStatus, errorThrown) {</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number26 index25 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number27 index26 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">});</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php plain">false;</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/script&gt;</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;style type=</code><code class="php string">"text/css"</code><code class="php plain">&gt;</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">.container{</code></div><div class="line number33 index32 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">width: 950px;</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">margin: 0 auto;</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">padding: 0;</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">h1{</code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">font-family: </code><code class="php string">'Helvetica Neue'</code><code class="php plain">, Helvetica, Arial, sans-serif;</code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">font-size: 24px;</code></div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">color: #777;</code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">div.clear{</code></div><div class="line number43 index42 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">clear: both;</code></div><div class="line number44 index43 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">ul.devices{</code></div><div class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">margin: 0;</code></div><div class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">padding: 0;</code></div><div class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">ul.devices li{</code></div><div class="line number50 index49 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">float: left;</code></div><div class="line number51 index50 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">list-style: none;</code></div><div class="line number52 index51 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">border: 1px solid #dedede;</code></div><div class="line number53 index52 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">padding: 10px;</code></div><div class="line number54 index53 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">margin: 0 15px 25px 0;</code></div><div class="line number55 index54 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">border-radius: 3px;</code></div><div class="line number56 index55 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.35);</code></div><div class="line number57 index56 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">-moz-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.35);</code></div><div class="line number58 index57 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">box-shadow: 0 1px 5px rgba(0, 0, 0, 0.35);</code></div><div class="line number59 index58 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">font-family: </code><code class="php string">'Helvetica Neue'</code><code class="php plain">, Helvetica, Arial, sans-serif;</code></div><div class="line number60 index59 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">color: #555;</code></div><div class="line number61 index60 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number62 index61 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">ul.devices li label, ul.devices li span{</code></div><div class="line number63 index62 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">font-family: </code><code class="php string">'Helvetica Neue'</code><code class="php plain">, Helvetica, Arial, sans-serif;</code></div><div class="line number64 index63 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">font-size: 12px;</code></div><div class="line number65 index64 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">font-style: normal;</code></div><div class="line number66 index65 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">font-variant: normal;</code></div><div class="line number67 index66 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">font-weight: bold;</code></div><div class="line number68 index67 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">color: #393939;</code></div><div class="line number69 index68 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">display: block;</code></div><div class="line number70 index69 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">float: left;</code></div><div class="line number71 index70 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number72 index71 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">ul.devices li label{</code></div><div class="line number73 index72 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">height: 25px;</code></div><div class="line number74 index73 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">width: 50px;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number75 index74 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number76 index75 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">ul.devices li textarea{</code></div><div class="line number77 index76 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">float: left;</code></div><div class="line number78 index77 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">resize: none;</code></div><div class="line number79 index78 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number80 index79 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">ul.devices li .send_btn{</code></div><div class="line number81 index80 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#0096FF), to(#005DFF));</code></div><div class="line number82 index81 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">background: -webkit-linear-gradient(0% 0%, 0% 100%, from(#0096FF), to(#005DFF));</code></div><div class="line number83 index82 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">background: -moz-linear-gradient(center top, #0096FF, #005DFF);</code></div><div class="line number84 index83 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">background: linear-gradient(#0096FF, #005DFF);</code></div><div class="line number85 index84 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">text-shadow: 0 1px 0 rgba(0, 0, 0, 0.3);</code></div><div class="line number86 index85 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">border-radius: 3px;</code></div><div class="line number87 index86 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">color: #fff;</code></div><div class="line number88 index87 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number89 index88 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/style&gt;</code></div><div class="line number90 index89 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/head&gt;</code></div><div class="line number91 index90 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;body&gt;</code></div><div class="line number92 index91 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php</code></div><div class="line number93 index92 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">include_once</code> <code class="php string">'db_functions.php'</code><code class="php plain">;</code></div><div class="line number94 index93 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$db</code> <code class="php plain">= </code><code class="php keyword">new</code> <code class="php plain">DB_Functions();</code></div><div class="line number95 index94 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$users</code> <code class="php plain">= </code><code class="php variable">$db</code><code class="php plain">-&gt;getAllUsers();</code></div><div class="line number96 index95 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$users</code> <code class="php plain">!= false)</code></div><div class="line number97 index96 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$no_of_users</code> <code class="php plain">= mysql_num_rows(</code><code class="php variable">$users</code><code class="php plain">);</code></div><div class="line number98 index97 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">else</code></div><div class="line number99 index98 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$no_of_users</code> <code class="php plain">= 0;</code></div><div class="line number100 index99 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">?&gt;</code></div><div class="line number101 index100 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"container"</code><code class="php plain">&gt;</code></div><div class="line number102 index101 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;h1&gt;No of Devices Registered: &lt;?php </code><code class="php functions">echo</code> <code class="php variable">$no_of_users</code><code class="php plain">; ?&gt;&lt;/h1&gt;</code></div><div class="line number103 index102 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;hr/&gt;</code></div><div class="line number104 index103 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;ul </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"devices"</code><code class="php plain">&gt;</code></div><div class="line number105 index104 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php</code></div><div class="line number106 index105 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$no_of_users</code> <code class="php plain">&gt; 0) {</code></div><div class="line number107 index106 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">?&gt;</code></div><div class="line number108 index107 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php</code></div><div class="line number109 index108 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">while</code> <code class="php plain">(</code><code class="php variable">$row</code> <code class="php plain">= mysql_fetch_array(</code><code class="php variable">$users</code><code class="php plain">)) {</code></div><div class="line number110 index109 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">?&gt;</code></div><div class="line number111 index110 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;li&gt;</code></div><div class="line number112 index111 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;form id=</code><code class="php string">"&lt;?php echo $row["</code><code class="php plain">id</code><code class="php string">"] ?&gt;"</code> <code class="php plain">name=</code><code class="php string">""</code> <code class="php plain">method=</code><code class="php string">"post"</code> <code class="php plain">onsubmit=</code><code class="php string">"return sendPushNotification('&lt;?php echo $row["</code><code class="php plain">id</code><code class="php string">"] ?&gt;')"</code><code class="php plain">&gt;</code></div><div class="line number113 index112 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;label&gt;Name: &lt;/label&gt; &lt;span&gt;&lt;?php </code><code class="php functions">echo</code> <code class="php variable">$row</code><code class="php plain">[</code><code class="php string">"name"</code><code class="php plain">] ?&gt;&lt;/span&gt;</code></div><div class="line number114 index113 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"clear"</code><code class="php plain">&gt;&lt;/div&gt;</code></div><div class="line number115 index114 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;label&gt;Email:&lt;/label&gt; &lt;span&gt;&lt;?php </code><code class="php functions">echo</code> <code class="php variable">$row</code><code class="php plain">[</code><code class="php string">"email"</code><code class="php plain">] ?&gt;&lt;/span&gt;</code></div><div class="line number116 index115 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"clear"</code><code class="php plain">&gt;&lt;/div&gt;</code></div><div class="line number117 index116 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;div </code><code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"send_container"</code><code class="php plain">&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number118 index117 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;textarea rows=</code><code class="php string">"3"</code> <code class="php plain">name=</code><code class="php string">"message"</code> <code class="php plain">cols=</code><code class="php string">"25"</code> <code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"txt_message"</code> <code class="php plain">placeholder=</code><code class="php string">"Type message here"</code><code class="php plain">&gt;&lt;/textarea&gt;</code></div><div class="line number119 index118 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;input type=</code><code class="php string">"hidden"</code> <code class="php plain">name=</code><code class="php string">"regId"</code> <code class="php plain">value=</code><code class="php string">"&lt;?php echo $row["</code><code class="php plain">gcm_regid</code><code class="php string">"] ?&gt;"</code><code class="php plain">/&gt;</code></div><div class="line number120 index119 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;input type=</code><code class="php string">"submit"</code> <code class="php keyword">class</code><code class="php plain">=</code><code class="php string">"send_btn"</code> <code class="php plain">value=</code><code class="php string">"Send"</code> <code class="php plain">onclick=</code><code class="php string">""</code><code class="php plain">/&gt;</code></div><div class="line number121 index120 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/div&gt;</code></div><div class="line number122 index121 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/form&gt;</code></div><div class="line number123 index122 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/li&gt;</code></div><div class="line number124 index123 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php }</code></div><div class="line number125 index124 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code><code class="php keyword">else</code> <code class="php plain">{ ?&gt; </code></div><div class="line number126 index125 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;li&gt;</code></div><div class="line number127 index126 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">No Users Registered Yet!</code></div><div class="line number128 index127 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/li&gt;</code></div><div class="line number129 index128 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;?php } ?&gt;</code></div><div class="line number130 index129 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/ul&gt;</code></div><div class="line number131 index130 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/div&gt;</code></div><div class="line number132 index131 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">&lt;/body&gt;</code></div><div class="line number133 index132 alt2"><code class="php plain">&lt;/html&gt;</code></div></div></td></tr></tbody></table></div></div><p>Following is a screenshot of the admin panel generated by above code (with users registered)</p><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/android_gcm_php_admin.png" alt="android gcm php admin panel" title="android gcm php admin panel" width="720px" height="auto" class="alignnone size-full wp-image-2335"></div><div class="downloadsection"> <iframe src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/cR45sih7T_M.html" frameborder="0" allowfullscreen="" style="width: 719px; height: 424.525423728814px;"></iframe></div><p>Until now we are done with setting up server side part. Now we can start writing android code.<br> <br></p><h3>Installing helper libraries and setting up the Emulator</h3><p>Before start writing android code we need to install the helper libraries and make required changes to the emulator.</p><p><strong>1</strong>. Goto your android SDK folder and open <em>SDK Manager</em> and install <em>Google Cloud Messaging for Android Library</em> under <em>Extras</em> section. (If you don’t see Google Cloud Messaging for Android Library update your SDK manager to latest version)</p><p><strong>2</strong>. After installing the library it will create <em>gcm.jar</em> file in your <strong>Andoird_SDK_Folder\extras\google\gcm\gcm-client\dist</strong>. Later you need to add this .jar file to your android project.</p><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/gcm_downloading_sdk.png" alt="android downloading gcm library" title="android downloading gcm library" width="720px" height="auto" class="alignnone size-full wp-image-2345"></div><p><strong>3</strong>. Now open your <em>AVD Manager</em> and create a new Google API emulator and start the emulator. (<strong>Note</strong>: To test gcm application in emulator you need to test it on Google API device only)<br> <strong>4</strong>. After launching emulator press <em>Menu</em> button goto <em>Settings</em>. Select <em>Accounts &amp; Sync</em>. And then press Add Account button and add a <em>Google account</em>.</p><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/android_gcm_adding_google_account1.png" alt="android gcm adding google account" title="android gcm adding google account" width="720px" height="auto" class="alignnone size-full wp-image-2362"></div><p>Check the following video to know about adding google account in the emulator</p><div class="downloadsection"> <iframe src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/ZqQugUEOMrc.html" frameborder="0" allowfullscreen="" style="width: 719px; height: 424.525423728814px;"></iframe></div><p>Once you are done adding google account you are good to start android project.<br> <br></p><h3>Creating Android Project</h3><p><strong>1</strong>. Create a new android project and fill the required details. While creating project select minimum SDK version API 8 to support wider range of devices.<br> <strong>2</strong>. After creating new project open <em>AndroidManifest.xml</em> file and do the following changes.<br> The following permission are required to make your project support gcm.</p><p><em>INTERNET</em> – To make your app use internet services<br> <em>ACCESS_NETWORK_STATE</em> – To access network state (used to detect internet status)<br> <em>GET_ACCOUNTS</em> – Required as GCM needs google account<br> <em>WAKE_LOCK</em> – Needed if your app need to wake your device when it sleeps<br> <em>VIBRATE</em> – Needed if your support vibration when receiving notification<br> Also add some broadcast receivers as mentioned below.</p><p>In the following code replace all <em>com.androidhive.pushnotifications</em> with your android package name.</p><div><div id="highlighter_257300" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><caption>AndroidManifest.xml</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;?</code><code class="xml keyword">xml</code> <code class="xml color1">version</code><code class="xml plain">=</code><code class="xml string">"1.0"</code> <code class="xml color1">encoding</code><code class="xml plain">=</code><code class="xml string">"utf-8"</code><code class="xml plain">?&gt;</code></div><div class="line number2 index1 alt1"><code class="xml plain">&lt;</code><code class="xml keyword">manifest</code> <code class="xml color1">xmlns:android</code><code class="xml plain">=</code><code class="xml string">"<a href="http://schemas.android.com/apk/res/android">http://schemas.android.com/apk/res/android</a>"</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">package</code><code class="xml plain">=</code><code class="xml string">"com.androidhive.pushnotifications"</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:versionCode</code><code class="xml plain">=</code><code class="xml string">"1"</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:versionName</code><code class="xml plain">=</code><code class="xml string">"1.0"</code> <code class="xml plain">&gt;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- GCM requires Android SDK version 2.2 (API level 8) or above. --&gt;</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">uses-sdk</code></div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:minSdkVersion</code><code class="xml plain">=</code><code class="xml string">"8"</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:targetSdkVersion</code><code class="xml plain">=</code><code class="xml string">"16"</code> <code class="xml plain">/&gt;</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- GCM connects to Internet Services. --&gt;</code></div><div class="line number13 index12 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.permission.INTERNET"</code> <code class="xml plain">/&gt;</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- GCM requires a Google account. --&gt;</code></div><div class="line number16 index15 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.permission.GET_ACCOUNTS"</code> <code class="xml plain">/&gt;</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Keeps the processor from sleeping when a message is received. --&gt;</code></div><div class="line number19 index18 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.permission.WAKE_LOCK"</code> <code class="xml plain">/&gt;</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Creates a custom permission so only this app can receive its messages. --&gt;</code></div><div class="line number22 index21 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">permission</code></div><div class="line number23 index22 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"com.androidhive.pushnotifications.permission.C2D_MESSAGE"</code></div><div class="line number24 index23 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:protectionLevel</code><code class="xml plain">=</code><code class="xml string">"signature"</code> <code class="xml plain">/&gt;</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"com.androidhive.pushnotifications.permission.C2D_MESSAGE"</code> <code class="xml plain">/&gt;</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- This app has permission to register and receive data message. --&gt;</code></div><div class="line number29 index28 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"com.google.android.c2dm.permission.RECEIVE"</code> <code class="xml plain">/&gt;</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Network State Permissions to detect Internet status --&gt;</code></div><div class="line number32 index31 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.permission.ACCESS_NETWORK_STATE"</code> <code class="xml plain">/&gt;</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Permission to vibrate --&gt;</code></div><div class="line number35 index34 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.permission.VIBRATE"</code> <code class="xml plain">/&gt;</code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Main activity. --&gt;</code></div><div class="line number38 index37 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">application</code></div><div class="line number39 index38 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:icon</code><code class="xml plain">=</code><code class="xml string">"@drawable/ic_launcher"</code></div><div class="line number40 index39 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:label</code><code class="xml plain">=</code><code class="xml string">"@string/app_name"</code> <code class="xml plain">&gt;</code></div><div class="line number41 index40 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Register Activity --&gt;</code></div><div class="line number42 index41 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">activity</code></div><div class="line number43 index42 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">".RegisterActivity"</code></div><div class="line number44 index43 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:label</code><code class="xml plain">=</code><code class="xml string">"@string/app_name"</code> <code class="xml plain">&gt;</code></div><div class="line number45 index44 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">intent-filter</code><code class="xml plain">&gt;</code></div><div class="line number46 index45 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">action</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.intent.action.MAIN"</code> <code class="xml plain">/&gt;</code></div><div class="line number47 index46 alt2">&nbsp;</div><div class="line number48 index47 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">category</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.intent.category.LAUNCHER"</code> <code class="xml plain">/&gt;</code></div><div class="line number49 index48 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">intent-filter</code><code class="xml plain">&gt;</code></div><div class="line number50 index49 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">activity</code><code class="xml plain">&gt;</code></div><div class="line number51 index50 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number52 index51 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Main Activity --&gt;</code></div><div class="line number53 index52 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">activity</code></div><div class="line number54 index53 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">".MainActivity"</code></div><div class="line number55 index54 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:configChanges</code><code class="xml plain">=</code><code class="xml string">"orientation|keyboardHidden"</code></div><div class="line number56 index55 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:label</code><code class="xml plain">=</code><code class="xml string">"@string/app_name"</code> <code class="xml plain">&gt;</code></div><div class="line number57 index56 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">activity</code><code class="xml plain">&gt;</code></div><div class="line number58 index57 alt1">&nbsp;</div><div class="line number59 index58 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">receiver</code></div><div class="line number60 index59 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"com.google.android.gcm.GCMBroadcastReceiver"</code></div><div class="line number61 index60 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:permission</code><code class="xml plain">=</code><code class="xml string">"com.google.android.c2dm.permission.SEND"</code> <code class="xml plain">&gt;</code></div><div class="line number62 index61 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">intent-filter</code><code class="xml plain">&gt;</code></div><div class="line number63 index62 alt2">&nbsp;</div><div class="line number64 index63 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Receives the actual messages. --&gt;</code></div><div class="line number65 index64 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">action</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"com.google.android.c2dm.intent.RECEIVE"</code> <code class="xml plain">/&gt;</code></div><div class="line number66 index65 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Receives the registration id. --&gt;</code></div><div class="line number67 index66 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">action</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"com.google.android.c2dm.intent.REGISTRATION"</code> <code class="xml plain">/&gt;</code></div><div class="line number68 index67 alt1">&nbsp;</div><div class="line number69 index68 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">category</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"com.androidhive.pushnotifications"</code> <code class="xml plain">/&gt;</code></div><div class="line number70 index69 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">intent-filter</code><code class="xml plain">&gt;</code></div><div class="line number71 index70 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">receiver</code><code class="xml plain">&gt;</code></div><div class="line number72 index71 alt1">&nbsp;</div><div class="line number73 index72 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">service</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">".GCMIntentService"</code> <code class="xml plain">/&gt;</code></div><div class="line number74 index73 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">application</code><code class="xml plain">&gt;</code></div><div class="line number75 index74 alt2">&nbsp;</div><div class="line number76 index75 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">manifest</code><code class="xml plain">&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>3</strong>. Open your <em>strings.xml</em> file under <em>res -&gt; values</em> folder and paste following strings. (If you don’t have strings.xml file, create a new one)</p><div><div id="highlighter_641131" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><caption>strings.xml</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">resources</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"app_name"</code><code class="xml plain">&gt;AndroidHive GCM&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"hello_world"</code><code class="xml plain">&gt;Hello world!&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"menu_settings"</code><code class="xml plain">&gt;Settings&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"title_activity_main"</code><code class="xml plain">&gt;Push Notifications&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"error_config"</code><code class="xml plain">&gt;Please set the %1$s constant and recompile the app.&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"already_registered"</code><code class="xml plain">&gt;Device is already registered on server.&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"gcm_registered"</code><code class="xml plain">&gt;From GCM: device successfully registered!&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"gcm_unregistered"</code><code class="xml plain">&gt;From GCM: device successfully unregistered!&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number11 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"gcm_message"</code><code class="xml plain">&gt;From GCM: you got message!&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number12 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"gcm_error"</code><code class="xml plain">&gt;From GCM: error (%1$s).&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number13 index12 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"gcm_recoverable_error"</code><code class="xml plain">&gt;From GCM: recoverable error (%1$s).&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number14 index13 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"gcm_deleted"</code><code class="xml plain">&gt;From GCM: server deleted %1$d pending messages!&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number15 index14 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"server_registering"</code><code class="xml plain">&gt;Trying (attempt %1$d/%2$d) to register device on Demo Server.&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number16 index15 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"server_registered"</code><code class="xml plain">&gt;From Demo Server: successfully added device!&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number17 index16 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"server_unregistered"</code><code class="xml plain">&gt;From Demo Server: successfully removed device!&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number18 index17 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"server_register_error"</code><code class="xml plain">&gt;Could not register device on Demo Server after %1$d attempts.&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number19 index18 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"server_unregister_error"</code><code class="xml plain">&gt;Could not unregister device on Demo Server (%1$s).&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number20 index19 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"options_register"</code><code class="xml plain">&gt;Register&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number21 index20 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"options_unregister"</code><code class="xml plain">&gt;Unregister&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number22 index21 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"options_clear"</code><code class="xml plain">&gt;Clear&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number23 index22 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">string</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"options_exit"</code><code class="xml plain">&gt;Exit&lt;/</code><code class="xml keyword">string</code><code class="xml plain">&gt;</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">resources</code><code class="xml plain">&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>4</strong>. Create a new class named <em>AlertDialogManager.java</em> and paste the following code. This class used to show alert dialog in your application.</p><div><div id="highlighter_413544" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><caption>AlertDialogManager.java</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.androidhive.pushnotifications;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">android.app.AlertDialog;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">android.content.Context;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java plain">android.content.DialogInterface;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">AlertDialogManager {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Function to display simple Alert Dialog</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @param context - application context</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @param title - alert dialog title</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @param message - alert message</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @param status - success/failure (used to set icon)</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - pass null if you don't want icon</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* */</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">showAlertDialog(Context context, String title, String message,</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Boolean status) {</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AlertDialog alertDialog = </code><code class="java keyword">new</code> <code class="java plain">AlertDialog.Builder(context).create();</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Setting Dialog Title</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alertDialog.setTitle(title);</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Setting Dialog Message</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alertDialog.setMessage(message);</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code><code class="java plain">(status != </code><code class="java keyword">null</code><code class="java plain">)</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Setting alert dialog icon</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alertDialog.setIcon((status) ? R.drawable.success : R.drawable.fail);</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Setting OK Button</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alertDialog.setButton(</code><code class="java string">"OK"</code><code class="java plain">, </code><code class="java keyword">new</code> <code class="java plain">DialogInterface.OnClickListener() {</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onClick(DialogInterface dialog, </code><code class="java keyword">int</code> <code class="java plain">which) {</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">});</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Showing Alert Message</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alertDialog.show();</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number39 index38 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><strong>5</strong>. Create another class named <em>ConnectionDetector.java</em> This class used to detect internet connection status.</p><div><div id="highlighter_862816" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><caption>ConnectionDetector.java</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.androidhive.pushnotifications;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">android.content.Context;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">android.net.ConnectivityManager;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java plain">android.net.NetworkInfo;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">ConnectionDetector {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">Context _context;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">ConnectionDetector(Context context){</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">this</code><code class="java plain">._context = context;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;</code>&nbsp;</div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Checking for all possible internet providers</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* **/</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">boolean</code> <code class="java plain">isConnectingToInternet(){</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ConnectivityManager connectivity = (ConnectivityManager) _context.getSystemService(Context.CONNECTIVITY_SERVICE);</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(connectivity != </code><code class="java keyword">null</code><code class="java plain">)</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">NetworkInfo[] info = connectivity.getAllNetworkInfo();</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(info != </code><code class="java keyword">null</code><code class="java plain">)</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(</code><code class="java keyword">int</code> <code class="java plain">i = </code><code class="java value">0</code><code class="java plain">; i &lt; info.length; i++)</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(info[i].getState() == NetworkInfo.State.CONNECTED)</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;</code>&nbsp;</div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">false</code><code class="java plain">;</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number33 index32 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><strong>6</strong>. Create class file called <em>CommonUtilities.java</em> and type the following code. This class   contains the GCM configuration and our server registration url.</p><p><em>SERVER_URL</em> – Your server user registration url<br> <em>SENDER_ID</em> – Google project id</p><div><div id="highlighter_210041" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><caption>CommonUtilities.java</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.androidhive.pushnotifications;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">android.content.Context;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">android.content.Intent;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">CommonUtilities {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// give your server registration url here</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">String SERVER_URL = </code><code class="java string">"<a href="http://10.0.2.2/gcm_server_php/register.php">http://10.0.2.2/gcm_server_php/register.php</a>"</code><code class="java plain">; </code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Google project id</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">String SENDER_ID = </code><code class="java string">"903913289319"</code><code class="java plain">; </code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Tag used on log messages.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">String TAG = </code><code class="java string">"AndroidHive GCM"</code><code class="java plain">;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">String DISPLAY_MESSAGE_ACTION =</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"com.androidhive.pushnotifications.DISPLAY_MESSAGE"</code><code class="java plain">;</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">String EXTRA_MESSAGE = </code><code class="java string">"message"</code><code class="java plain">;</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Notifies UI to display a message.</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* &lt;p&gt;</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* This method is defined in the common helper because it's used both by</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* the UI and the background service.</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @param context application's context.</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @param message message to be displayed.</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">displayMessage(Context context, String message) {</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent intent = </code><code class="java keyword">new</code> <code class="java plain">Intent(DISPLAY_MESSAGE_ACTION);</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">intent.putExtra(EXTRA_MESSAGE, message);</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">context.sendBroadcast(intent);</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number38 index37 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><strong>7</strong>. Create a new class called <em>ServerUtilities.java</em> with following content. This class has following funtions</p><div><div id="highlighter_250915" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// function to register a user on our server(name, email, gcm reg id)</code></div><div class="line number2 index1 alt1"><code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">register()</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="java comments">// function to unregister the device</code></div><div class="line number5 index4 alt2"><code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">unregister()</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="java comments">// method to POST data to server</code></div><div class="line number8 index7 alt1"><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">post()</code></div></div></td></tr></tbody></table></div></div><div><div id="highlighter_759172" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><caption>ServerUtilities.java</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.androidhive.pushnotifications;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.SERVER_URL;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.TAG;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.displayMessage;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="java keyword">import</code> <code class="java plain">java.io.IOException;</code></div><div class="line number8 index7 alt1"><code class="java keyword">import</code> <code class="java plain">java.io.OutputStream;</code></div><div class="line number9 index8 alt2"><code class="java keyword">import</code> <code class="java plain">java.net.HttpURLConnection;</code></div><div class="line number10 index9 alt1"><code class="java keyword">import</code> <code class="java plain">java.net.MalformedURLException;</code></div><div class="line number11 index10 alt2"><code class="java keyword">import</code> <code class="java plain">java.net.URL;</code></div><div class="line number12 index11 alt1"><code class="java keyword">import</code> <code class="java plain">java.util.HashMap;</code></div><div class="line number13 index12 alt2"><code class="java keyword">import</code> <code class="java plain">java.util.Iterator;</code></div><div class="line number14 index13 alt1"><code class="java keyword">import</code> <code class="java plain">java.util.Map;</code></div><div class="line number15 index14 alt2"><code class="java keyword">import</code> <code class="java plain">java.util.Map.Entry;</code></div><div class="line number16 index15 alt1"><code class="java keyword">import</code> <code class="java plain">java.util.Random;</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="java keyword">import</code> <code class="java plain">android.content.Context;</code></div><div class="line number19 index18 alt2"><code class="java keyword">import</code> <code class="java plain">android.util.Log;</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="java keyword">import</code> <code class="java plain">com.google.android.gcm.GCMRegistrar;</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">ServerUtilities {</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">MAX_ATTEMPTS = </code><code class="java value">5</code><code class="java plain">;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">BACKOFF_MILLI_SECONDS = </code><code class="java value">2000</code><code class="java plain">;</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">Random random = </code><code class="java keyword">new</code> <code class="java plain">Random();</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Register this account/device pair within the server.</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">register(</code><code class="java keyword">final</code> <code class="java plain">Context context, String name, String email, </code><code class="java keyword">final</code> <code class="java plain">String regId) {</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.i(TAG, </code><code class="java string">"registering device (regId = "</code> <code class="java plain">+ regId + </code><code class="java string">")"</code><code class="java plain">);</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String serverUrl = SERVER_URL;</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Map&lt;String, String&gt; params = </code><code class="java keyword">new</code> <code class="java plain">HashMap&lt;String, String&gt;();</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">params.put(</code><code class="java string">"regId"</code><code class="java plain">, regId);</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">params.put(</code><code class="java string">"name"</code><code class="java plain">, name);</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">params.put(</code><code class="java string">"email"</code><code class="java plain">, email);</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">long</code> <code class="java plain">backoff = BACKOFF_MILLI_SECONDS + random.nextInt(</code><code class="java value">1000</code><code class="java plain">);</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Once GCM returns a registration id, we need to register on our server</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// As the server might be down, we will retry it a couple</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// times.</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(</code><code class="java keyword">int</code> <code class="java plain">i = </code><code class="java value">1</code><code class="java plain">; i &lt;= MAX_ATTEMPTS; i++) {</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.d(TAG, </code><code class="java string">"Attempt #"</code> <code class="java plain">+ i + </code><code class="java string">" to register"</code><code class="java plain">);</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">displayMessage(context, context.getString(</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">R.string.server_registering, i, MAX_ATTEMPTS));</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">post(serverUrl, params);</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GCMRegistrar.setRegisteredOnServer(context, </code><code class="java keyword">true</code><code class="java plain">);</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String message = context.getString(R.string.server_registered);</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">CommonUtilities.displayMessage(context, message);</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(IOException e) {</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Here we are simplifying and retrying on any error; in a real</code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// application, it should retry only on unrecoverable errors</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// (like HTTP error code 503).</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.e(TAG, </code><code class="java string">"Failed to register on attempt "</code> <code class="java plain">+ i + </code><code class="java string">":"</code> <code class="java plain">+ e);</code></div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(i == MAX_ATTEMPTS) {</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">break</code><code class="java plain">;</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number64 index63 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.d(TAG, </code><code class="java string">"Sleeping for "</code> <code class="java plain">+ backoff + </code><code class="java string">" ms before retry"</code><code class="java plain">);</code></div><div class="line number65 index64 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Thread.sleep(backoff);</code></div><div class="line number66 index65 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(InterruptedException e1) {</code></div><div class="line number67 index66 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Activity finished before we complete - exit.</code></div><div class="line number68 index67 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.d(TAG, </code><code class="java string">"Thread interrupted: abort remaining retries!"</code><code class="java plain">);</code></div><div class="line number69 index68 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Thread.currentThread().interrupt();</code></div><div class="line number70 index69 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number71 index70 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number72 index71 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// increase backoff exponentially</code></div><div class="line number73 index72 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">backoff *= </code><code class="java value">2</code><code class="java plain">;</code></div><div class="line number74 index73 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number75 index74 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number76 index75 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String message = context.getString(R.string.server_register_error,</code></div><div class="line number77 index76 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MAX_ATTEMPTS);</code></div><div class="line number78 index77 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">CommonUtilities.displayMessage(context, message);</code></div><div class="line number79 index78 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number80 index79 alt1">&nbsp;</div><div class="line number81 index80 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number82 index81 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Unregister this account/device pair within the server.</code></div><div class="line number83 index82 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number84 index83 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">unregister(</code><code class="java keyword">final</code> <code class="java plain">Context context, </code><code class="java keyword">final</code> <code class="java plain">String regId) {</code></div><div class="line number85 index84 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.i(TAG, </code><code class="java string">"unregistering device (regId = "</code> <code class="java plain">+ regId + </code><code class="java string">")"</code><code class="java plain">);</code></div><div class="line number86 index85 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String serverUrl = SERVER_URL + </code><code class="java string">"/unregister"</code><code class="java plain">;</code></div><div class="line number87 index86 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Map&lt;String, String&gt; params = </code><code class="java keyword">new</code> <code class="java plain">HashMap&lt;String, String&gt;();</code></div><div class="line number88 index87 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">params.put(</code><code class="java string">"regId"</code><code class="java plain">, regId);</code></div><div class="line number89 index88 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number90 index89 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">post(serverUrl, params);</code></div><div class="line number91 index90 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GCMRegistrar.setRegisteredOnServer(context, </code><code class="java keyword">false</code><code class="java plain">);</code></div><div class="line number92 index91 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String message = context.getString(R.string.server_unregistered);</code></div><div class="line number93 index92 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">CommonUtilities.displayMessage(context, message);</code></div><div class="line number94 index93 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(IOException e) {</code></div><div class="line number95 index94 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// At this point the device is unregistered from GCM, but still</code></div><div class="line number96 index95 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// registered in the server.</code></div><div class="line number97 index96 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// We could try to unregister again, but it is not necessary:</code></div><div class="line number98 index97 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// if the server tries to send a message to the device, it will get</code></div><div class="line number99 index98 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// a "NotRegistered" error message and should unregister the device.</code></div><div class="line number100 index99 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String message = context.getString(R.string.server_unregister_error,</code></div><div class="line number101 index100 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">e.getMessage());</code></div><div class="line number102 index101 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">CommonUtilities.displayMessage(context, message);</code></div><div class="line number103 index102 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number104 index103 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number105 index104 alt2">&nbsp;</div><div class="line number106 index105 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number107 index106 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Issue a POST request to the server.</code></div><div class="line number108 index107 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number109 index108 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @param endpoint POST address.</code></div><div class="line number110 index109 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @param params request parameters.</code></div><div class="line number111 index110 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number112 index111 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* @throws IOException propagated from POST.</code></div><div class="line number113 index112 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number114 index113 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">post(String endpoint, Map&lt;String, String&gt; params)</code></div><div class="line number115 index114 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throws</code> <code class="java plain">IOException {&nbsp;&nbsp;&nbsp; </code></div><div class="line number116 index115 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number117 index116 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">URL url;</code></div><div class="line number118 index117 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number119 index118 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">url = </code><code class="java keyword">new</code> <code class="java plain">URL(endpoint);</code></div><div class="line number120 index119 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(MalformedURLException e) {</code></div><div class="line number121 index120 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">IllegalArgumentException(</code><code class="java string">"invalid url: "</code> <code class="java plain">+ endpoint);</code></div><div class="line number122 index121 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number123 index122 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">StringBuilder bodyBuilder = </code><code class="java keyword">new</code> <code class="java plain">StringBuilder();</code></div><div class="line number124 index123 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Iterator&lt;Entry&lt;String, String&gt;&gt; iterator = params.entrySet().iterator();</code></div><div class="line number125 index124 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// constructs the POST body using the parameters</code></div><div class="line number126 index125 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">while</code> <code class="java plain">(iterator.hasNext()) {</code></div><div class="line number127 index126 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Entry&lt;String, String&gt; param = iterator.next();</code></div><div class="line number128 index127 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">bodyBuilder.append(param.getKey()).append(</code><code class="java string">'='</code><code class="java plain">)</code></div><div class="line number129 index128 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.append(param.getValue());</code></div><div class="line number130 index129 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(iterator.hasNext()) {</code></div><div class="line number131 index130 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">bodyBuilder.append(</code><code class="java string">'&amp;'</code><code class="java plain">);</code></div><div class="line number132 index131 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number133 index132 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number134 index133 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String body = bodyBuilder.toString();</code></div><div class="line number135 index134 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.v(TAG, </code><code class="java string">"Posting '"</code> <code class="java plain">+ body + </code><code class="java string">"' to "</code> <code class="java plain">+ url);</code></div><div class="line number136 index135 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">byte</code><code class="java plain">[] bytes = body.getBytes();</code></div><div class="line number137 index136 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">HttpURLConnection conn = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number138 index137 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number139 index138 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.e(</code><code class="java string">"URL"</code><code class="java plain">, </code><code class="java string">"&gt; "</code> <code class="java plain">+ url);</code></div><div class="line number140 index139 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">conn = (HttpURLConnection) url.openConnection();</code></div><div class="line number141 index140 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">conn.setDoOutput(</code><code class="java keyword">true</code><code class="java plain">);</code></div><div class="line number142 index141 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">conn.setUseCaches(</code><code class="java keyword">false</code><code class="java plain">);</code></div><div class="line number143 index142 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">conn.setFixedLengthStreamingMode(bytes.length);</code></div><div class="line number144 index143 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">conn.setRequestMethod(</code><code class="java string">"POST"</code><code class="java plain">);</code></div><div class="line number145 index144 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">conn.setRequestProperty(</code><code class="java string">"Content-Type"</code><code class="java plain">,</code></div><div class="line number146 index145 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"application/x-www-form-urlencoded;charset=UTF-8"</code><code class="java plain">);</code></div><div class="line number147 index146 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// post the request</code></div><div class="line number148 index147 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">OutputStream out = conn.getOutputStream();</code></div><div class="line number149 index148 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">out.write(bytes);</code></div><div class="line number150 index149 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">out.close();</code></div><div class="line number151 index150 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// handle the response</code></div><div class="line number152 index151 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">status = conn.getResponseCode();</code></div><div class="line number153 index152 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(status != </code><code class="java value">200</code><code class="java plain">) {</code></div><div class="line number154 index153 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">IOException(</code><code class="java string">"Post failed with error code "</code> <code class="java plain">+ status);</code></div><div class="line number155 index154 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number156 index155 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">finally</code> <code class="java plain">{</code></div><div class="line number157 index156 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(conn != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number158 index157 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">conn.disconnect();</code></div><div class="line number159 index158 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number160 index159 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number161 index160 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number162 index161 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><strong>8</strong>. Add a new class file called <em>GCMIntentService.java</em> This class handles all GCM related services.</p><div><div id="highlighter_393087" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// method called once the device successfully registered with GCM</code></div><div class="line number2 index1 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onRegistered()</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="java comments">// called when a new message arrived to device</code></div><div class="line number5 index4 alt2"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onMessage()</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="java comments">// called when device is unregistered with GCM services</code></div><div class="line number8 index7 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onUnregistered()</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="java comments">// On receiving an error</code></div><div class="line number11 index10 alt2"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onError()</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="java comments">// method to generate a notification</code></div><div class="line number14 index13 alt1"><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">generateNotification()</code></div></div></td></tr></tbody></table></div></div><div><div id="highlighter_992946" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><caption>GCMIntentService.java</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.androidhive.pushnotifications;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">android.app.Notification;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">android.app.NotificationManager;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java plain">android.app.PendingIntent;</code></div><div class="line number6 index5 alt1"><code class="java keyword">import</code> <code class="java plain">android.content.Context;</code></div><div class="line number7 index6 alt2"><code class="java keyword">import</code> <code class="java plain">android.content.Intent;</code></div><div class="line number8 index7 alt1"><code class="java keyword">import</code> <code class="java plain">android.util.Log;</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="java keyword">import</code> <code class="java plain">com.google.android.gcm.GCMBaseIntentService;</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.SENDER_ID;</code></div><div class="line number13 index12 alt2"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.displayMessage;</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">GCMIntentService </code><code class="java keyword">extends</code> <code class="java plain">GCMBaseIntentService {</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">String TAG = </code><code class="java string">"GCMIntentService"</code><code class="java plain">;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">GCMIntentService() {</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">(SENDER_ID);</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Method called on device registered</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">**/</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onRegistered(Context context, String registrationId) {</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.i(TAG, </code><code class="java string">"Device registered: regId = "</code> <code class="java plain">+ registrationId);</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">displayMessage(context, </code><code class="java string">"Your device registred with GCM"</code><code class="java plain">);</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.d(</code><code class="java string">"NAME"</code><code class="java plain">, MainActivity.name);</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ServerUtilities.register(context, MainActivity.name, MainActivity.email, registrationId);</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Method called on device un registred</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* */</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onUnregistered(Context context, String registrationId) {</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.i(TAG, </code><code class="java string">"Device unregistered"</code><code class="java plain">);</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">displayMessage(context, getString(R.string.gcm_unregistered));</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ServerUtilities.unregister(context, registrationId);</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number43 index42 alt2">&nbsp;</div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Method called on Receiving a new message</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* */</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onMessage(Context context, Intent intent) {</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.i(TAG, </code><code class="java string">"Received message"</code><code class="java plain">);</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String message = intent.getExtras().getString(</code><code class="java string">"price"</code><code class="java plain">);</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">displayMessage(context, message);</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// notifies user</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">generateNotification(context, message);</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number56 index55 alt1">&nbsp;</div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Method called on receiving a deleted message</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* */</code></div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onDeletedMessages(Context context, </code><code class="java keyword">int</code> <code class="java plain">total) {</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.i(TAG, </code><code class="java string">"Received deleted messages notification"</code><code class="java plain">);</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String message = getString(R.string.gcm_deleted, total);</code></div><div class="line number64 index63 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">displayMessage(context, message);</code></div><div class="line number65 index64 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// notifies user</code></div><div class="line number66 index65 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">generateNotification(context, message);</code></div><div class="line number67 index66 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number68 index67 alt1">&nbsp;</div><div class="line number69 index68 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number70 index69 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Method called on Error</code></div><div class="line number71 index70 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* */</code></div><div class="line number72 index71 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number73 index72 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onError(Context context, String errorId) {</code></div><div class="line number74 index73 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.i(TAG, </code><code class="java string">"Received error: "</code> <code class="java plain">+ errorId);</code></div><div class="line number75 index74 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">displayMessage(context, getString(R.string.gcm_error, errorId));</code></div><div class="line number76 index75 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number77 index76 alt2">&nbsp;</div><div class="line number78 index77 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number79 index78 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java keyword">boolean</code> <code class="java plain">onRecoverableError(Context context, String errorId) {</code></div><div class="line number80 index79 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// log message</code></div><div class="line number81 index80 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.i(TAG, </code><code class="java string">"Received recoverable error: "</code> <code class="java plain">+ errorId);</code></div><div class="line number82 index81 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">displayMessage(context, getString(R.string.gcm_recoverable_error,</code></div><div class="line number83 index82 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">errorId));</code></div><div class="line number84 index83 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">super</code><code class="java plain">.onRecoverableError(context, errorId);</code></div><div class="line number85 index84 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number86 index85 alt1">&nbsp;</div><div class="line number87 index86 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number88 index87 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Issues a notification to inform the user that server has sent a message.</code></div><div class="line number89 index88 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number90 index89 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">generateNotification(Context context, String message) {</code></div><div class="line number91 index90 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">icon = R.drawable.ic_launcher;</code></div><div class="line number92 index91 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">long</code> <code class="java plain">when = System.currentTimeMillis();</code></div><div class="line number93 index92 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">NotificationManager notificationManager = (NotificationManager)</code></div><div class="line number94 index93 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">context.getSystemService(Context.NOTIFICATION_SERVICE);</code></div><div class="line number95 index94 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Notification notification = </code><code class="java keyword">new</code> <code class="java plain">Notification(icon, message, when);</code></div><div class="line number96 index95 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number97 index96 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String title = context.getString(R.string.app_name);</code></div><div class="line number98 index97 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number99 index98 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent notificationIntent = </code><code class="java keyword">new</code> <code class="java plain">Intent(context, MainActivity.</code><code class="java keyword">class</code><code class="java plain">);</code></div><div class="line number100 index99 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// set intent so it does not start a new activity</code></div><div class="line number101 index100 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">notificationIntent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP |</code></div><div class="line number102 index101 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent.FLAG_ACTIVITY_SINGLE_TOP);</code></div><div class="line number103 index102 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">PendingIntent intent =</code></div><div class="line number104 index103 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">PendingIntent.getActivity(context, </code><code class="java value">0</code><code class="java plain">, notificationIntent, </code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number105 index104 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">notification.setLatestEventInfo(context, title, message, intent);</code></div><div class="line number106 index105 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">notification.flags |= Notification.FLAG_AUTO_CANCEL;</code></div><div class="line number107 index106 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number108 index107 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Play default notification sound</code></div><div class="line number109 index108 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">notification.defaults |= Notification.DEFAULT_SOUND;</code></div><div class="line number110 index109 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number111 index110 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Vibrate if vibrate is enabled</code></div><div class="line number112 index111 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">notification.defaults |= Notification.DEFAULT_VIBRATE;</code></div><div class="line number113 index112 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">notificationManager.notify(</code><code class="java value">0</code><code class="java plain">, notification);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number114 index113 alt1">&nbsp;</div><div class="line number115 index114 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number116 index115 alt1">&nbsp;</div><div class="line number117 index116 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><strong>9</strong>. Here i am adding a registration screen where user can register using their details. To make this tutorial simple i am asking only name and email only. Once user registration is done the user details will be sent to our server where the user details will be stored in mysql database.</p><p>Create a new xml file called <em>activity_register.xml</em> under <em>res -&gt; layout</em> folder and paste the following code.</p><div><div id="highlighter_14154" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><caption>activity_register.xml</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">LinearLayout</code> <code class="xml color1">xmlns:android</code><code class="xml plain">=</code><code class="xml string">"<a href="http://schemas.android.com/apk/res/android">http://schemas.android.com/apk/res/android</a>"</code></div><div class="line number2 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">xmlns:tools</code><code class="xml plain">=</code><code class="xml string">"<a href="http://schemas.android.com/tools">http://schemas.android.com/tools</a>"</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_width</code><code class="xml plain">=</code><code class="xml string">"match_parent"</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_height</code><code class="xml plain">=</code><code class="xml string">"match_parent"</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:orientation</code><code class="xml plain">=</code><code class="xml string">"vertical"</code> <code class="xml plain">&gt;&nbsp;&nbsp;&nbsp; </code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">TextView</code> <code class="xml color1">android:layout_width</code><code class="xml plain">=</code><code class="xml string">"fill_parent"</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_height</code><code class="xml plain">=</code><code class="xml string">"wrap_content"</code></div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:text</code><code class="xml plain">=</code><code class="xml string">"Full Name:"</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_marginLeft</code><code class="xml plain">=</code><code class="xml string">"10dip"</code></div><div class="line number11 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_marginRight</code><code class="xml plain">=</code><code class="xml string">"10dip"</code></div><div class="line number12 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_marginTop</code><code class="xml plain">=</code><code class="xml string">"20dip"</code><code class="xml plain">/&gt;</code></div><div class="line number13 index12 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number14 index13 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">EditText</code> <code class="xml color1">android:id</code><code class="xml plain">=</code><code class="xml string">"@+id/txtName"</code></div><div class="line number15 index14 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_width</code><code class="xml plain">=</code><code class="xml string">"fill_parent"</code></div><div class="line number16 index15 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_height</code><code class="xml plain">=</code><code class="xml string">"wrap_content"</code></div><div class="line number17 index16 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_margin</code><code class="xml plain">=</code><code class="xml string">"10dip"</code></div><div class="line number18 index17 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_marginBottom</code><code class="xml plain">=</code><code class="xml string">"20dip"</code><code class="xml plain">/&gt;</code></div><div class="line number19 index18 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number20 index19 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">TextView</code> <code class="xml color1">android:layout_width</code><code class="xml plain">=</code><code class="xml string">"fill_parent"</code></div><div class="line number21 index20 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_height</code><code class="xml plain">=</code><code class="xml string">"wrap_content"</code></div><div class="line number22 index21 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:text</code><code class="xml plain">=</code><code class="xml string">"Email:"</code></div><div class="line number23 index22 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_marginLeft</code><code class="xml plain">=</code><code class="xml string">"10dip"</code></div><div class="line number24 index23 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_marginRight</code><code class="xml plain">=</code><code class="xml string">"10dip"</code><code class="xml plain">/&gt;</code></div><div class="line number25 index24 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number26 index25 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">EditText</code> <code class="xml color1">android:id</code><code class="xml plain">=</code><code class="xml string">"@+id/txtEmail"</code></div><div class="line number27 index26 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_width</code><code class="xml plain">=</code><code class="xml string">"fill_parent"</code></div><div class="line number28 index27 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_height</code><code class="xml plain">=</code><code class="xml string">"wrap_content"</code></div><div class="line number29 index28 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_margin</code><code class="xml plain">=</code><code class="xml string">"10dip"</code></div><div class="line number30 index29 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_marginBottom</code><code class="xml plain">=</code><code class="xml string">"20dip"</code><code class="xml plain">/&gt;</code></div><div class="line number31 index30 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number32 index31 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">Button</code> <code class="xml color1">android:id</code><code class="xml plain">=</code><code class="xml string">"@+id/btnRegister"</code></div><div class="line number33 index32 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_width</code><code class="xml plain">=</code><code class="xml string">"fill_parent"</code></div><div class="line number34 index33 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_height</code><code class="xml plain">=</code><code class="xml string">"wrap_content"</code></div><div class="line number35 index34 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:text</code><code class="xml plain">=</code><code class="xml string">"Register"</code></div><div class="line number36 index35 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml color1">android:layout_margin</code><code class="xml plain">=</code><code class="xml string">"10dip"</code><code class="xml plain">/&gt;</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">LinearLayout</code><code class="xml plain">&gt;</code></div></div></td></tr></tbody></table></div></div><p><strong>10</strong>. Create a new class called <em>RegisterActivity.java</em> This class will be used to handler user registration.</p><p>In the following code first internet status and gcm configuration is checked and once user presses the registration button user details will be send to <em>MainActivity.java</em> from there they will send to our server.</p><div><div id="highlighter_746578" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><caption>RegisterActivity.java</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.androidhive.pushnotifications;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.SENDER_ID;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.SERVER_URL;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java plain">android.app.Activity;</code></div><div class="line number6 index5 alt1"><code class="java keyword">import</code> <code class="java plain">android.content.Intent;</code></div><div class="line number7 index6 alt2"><code class="java keyword">import</code> <code class="java plain">android.os.Bundle;</code></div><div class="line number8 index7 alt1"><code class="java keyword">import</code> <code class="java plain">android.view.View;</code></div><div class="line number9 index8 alt2"><code class="java keyword">import</code> <code class="java plain">android.widget.Button;</code></div><div class="line number10 index9 alt1"><code class="java keyword">import</code> <code class="java plain">android.widget.EditText;</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">RegisterActivity </code><code class="java keyword">extends</code> <code class="java plain">Activity {</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// alert dialog manager</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AlertDialogManager alert = </code><code class="java keyword">new</code> <code class="java plain">AlertDialogManager();</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Internet detector</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ConnectionDetector cd;</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// UI elements</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">EditText txtName;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">EditText txtEmail;</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Register button</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Button btnRegister;</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState) {</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onCreate(savedInstanceState);</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">setContentView(R.layout.activity_register);</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">cd = </code><code class="java keyword">new</code> <code class="java plain">ConnectionDetector(getApplicationContext());</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check if Internet present</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!cd.isConnectingToInternet()) {</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Internet Connection is not present</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alert.showAlertDialog(RegisterActivity.</code><code class="java keyword">this</code><code class="java plain">,</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"Internet Connection Error"</code><code class="java plain">,</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"Please connect to working Internet connection"</code><code class="java plain">, </code><code class="java keyword">false</code><code class="java plain">);</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// stop executing code by return</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number42 index41 alt1">&nbsp;</div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check if GCM configuration is set</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(SERVER_URL == </code><code class="java keyword">null</code> <code class="java plain">|| SENDER_ID == </code><code class="java keyword">null</code> <code class="java plain">|| SERVER_URL.length() == </code><code class="java value">0</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">|| SENDER_ID.length() == </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// GCM sernder id / server url is missing</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alert.showAlertDialog(RegisterActivity.</code><code class="java keyword">this</code><code class="java plain">, </code><code class="java string">"Configuration Error!"</code><code class="java plain">,</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"Please set your Server URL and GCM Sender ID"</code><code class="java plain">, </code><code class="java keyword">false</code><code class="java plain">);</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// stop executing code by return</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">txtName = (EditText) findViewById(R.id.txtName);</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">txtEmail = (EditText) findViewById(R.id.txtEmail);</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">btnRegister = (Button) findViewById(R.id.btnRegister);</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/*</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">* Click event on Register button</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">* */</code></div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">btnRegister.setOnClickListener(</code><code class="java keyword">new</code> <code class="java plain">View.OnClickListener() {</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onClick(View arg0) {</code></div><div class="line number64 index63 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Read EditText dat</code></div><div class="line number65 index64 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String name = txtName.getText().toString();</code></div><div class="line number66 index65 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String email = txtEmail.getText().toString();</code></div><div class="line number67 index66 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number68 index67 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check if user filled the form</code></div><div class="line number69 index68 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code><code class="java plain">(name.trim().length() &gt; </code><code class="java value">0</code> <code class="java plain">&amp;&amp; email.trim().length() &gt; </code><code class="java value">0</code><code class="java plain">){</code></div><div class="line number70 index69 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Launch Main Activity</code></div><div class="line number71 index70 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent i = </code><code class="java keyword">new</code> <code class="java plain">Intent(getApplicationContext(), MainActivity.</code><code class="java keyword">class</code><code class="java plain">);</code></div><div class="line number72 index71 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number73 index72 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Registering user on our server&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number74 index73 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Sending registraiton details to MainActivity</code></div><div class="line number75 index74 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">i.putExtra(</code><code class="java string">"name"</code><code class="java plain">, name);</code></div><div class="line number76 index75 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">i.putExtra(</code><code class="java string">"email"</code><code class="java plain">, email);</code></div><div class="line number77 index76 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">startActivity(i);</code></div><div class="line number78 index77 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">finish();</code></div><div class="line number79 index78 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code><code class="java keyword">else</code><code class="java plain">{</code></div><div class="line number80 index79 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// user doen't filled that data</code></div><div class="line number81 index80 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// ask him to fill the form</code></div><div class="line number82 index81 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alert.showAlertDialog(RegisterActivity.</code><code class="java keyword">this</code><code class="java plain">, </code><code class="java string">"Registration Error!"</code><code class="java plain">, </code><code class="java string">"Please enter your details"</code><code class="java plain">, </code><code class="java keyword">false</code><code class="java plain">);</code></div><div class="line number83 index82 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number84 index83 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number85 index84 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">});</code></div><div class="line number86 index85 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number87 index86 alt2">&nbsp;</div><div class="line number88 index87 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><div class="image"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/android_gcm_device_registration.png" alt="android device gcm registration" title="android device gcm registration" width="720px" height="auto" class="alignnone size-full wp-image-2371"></div><p><strong>11</strong>. Now open your main activity file (In my case <em>MainActivity.java</em>) and type the following code.<br> In the following code<br> I am receiving name, email sent from RegisterActivity and storing them in static variables.</p><p>Then i am checking whether this device has gcm registration id, if not i am registering it on gcm by calling <em>GCMRegistrar.register(this, SENDER_ID)</em> method</p><p><em>private final BroadcastReceiver mHandleMessageReceiver = new BroadcastReceiver()</em> method will be called when device gets a new push notification message. For now i am displaying the message on the screen. You might need to take appropriate action on the message depending upon your app requirement. (Example: Storing it in SQLite database)</p><div><div id="highlighter_18575" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><caption>MainActivity.java</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.androidhive.pushnotifications;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.DISPLAY_MESSAGE_ACTION;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.EXTRA_MESSAGE;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java keyword">static</code> <code class="java plain">com.androidhive.pushnotifications.CommonUtilities.SENDER_ID;</code></div><div class="line number6 index5 alt1"><code class="java keyword">import</code> <code class="java plain">android.app.Activity;</code></div><div class="line number7 index6 alt2"><code class="java keyword">import</code> <code class="java plain">android.content.BroadcastReceiver;</code></div><div class="line number8 index7 alt1"><code class="java keyword">import</code> <code class="java plain">android.content.Context;</code></div><div class="line number9 index8 alt2"><code class="java keyword">import</code> <code class="java plain">android.content.Intent;</code></div><div class="line number10 index9 alt1"><code class="java keyword">import</code> <code class="java plain">android.content.IntentFilter;</code></div><div class="line number11 index10 alt2"><code class="java keyword">import</code> <code class="java plain">android.os.AsyncTask;</code></div><div class="line number12 index11 alt1"><code class="java keyword">import</code> <code class="java plain">android.os.Bundle;</code></div><div class="line number13 index12 alt2"><code class="java keyword">import</code> <code class="java plain">android.util.Log;</code></div><div class="line number14 index13 alt1"><code class="java keyword">import</code> <code class="java plain">android.widget.TextView;</code></div><div class="line number15 index14 alt2"><code class="java keyword">import</code> <code class="java plain">android.widget.Toast;</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="java keyword">import</code> <code class="java plain">com.google.android.gcm.GCMRegistrar;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">MainActivity </code><code class="java keyword">extends</code> <code class="java plain">Activity {</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// label to display gcm messages</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TextView lblMessage;</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Asyntask</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AsyncTask&lt;Void, Void, Void&gt; mRegisterTask;</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Alert dialog manager</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AlertDialogManager alert = </code><code class="java keyword">new</code> <code class="java plain">AlertDialogManager();</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Connection detector</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ConnectionDetector cd;</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java plain">String name;</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java plain">String email;</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState) {</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onCreate(savedInstanceState);</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">setContentView(R.layout.activity_main);</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">cd = </code><code class="java keyword">new</code> <code class="java plain">ConnectionDetector(getApplicationContext());</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check if Internet present</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!cd.isConnectingToInternet()) {</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Internet Connection is not present</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">alert.showAlertDialog(MainActivity.</code><code class="java keyword">this</code><code class="java plain">,</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"Internet Connection Error"</code><code class="java plain">,</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"Please connect to working Internet connection"</code><code class="java plain">, </code><code class="java keyword">false</code><code class="java plain">);</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// stop executing code by return</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Getting name, email from intent</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent i = getIntent();</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">name = i.getStringExtra(</code><code class="java string">"name"</code><code class="java plain">);</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">email = i.getStringExtra(</code><code class="java string">"email"</code><code class="java plain">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Make sure the device has the proper dependencies.</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GCMRegistrar.checkDevice(</code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number60 index59 alt1">&nbsp;</div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Make sure the manifest was properly set - comment out this line</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// while developing the app, then uncomment it when it's ready.</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GCMRegistrar.checkManifest(</code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number64 index63 alt1">&nbsp;</div><div class="line number65 index64 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">lblMessage = (TextView) findViewById(R.id.lblMessage);</code></div><div class="line number66 index65 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number67 index66 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">registerReceiver(mHandleMessageReceiver, </code><code class="java keyword">new</code> <code class="java plain">IntentFilter(</code></div><div class="line number68 index67 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">DISPLAY_MESSAGE_ACTION));</code></div><div class="line number69 index68 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number70 index69 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Get GCM registration id</code></div><div class="line number71 index70 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">String regId = GCMRegistrar.getRegistrationId(</code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number72 index71 alt1">&nbsp;</div><div class="line number73 index72 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check if regid already presents</code></div><div class="line number74 index73 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(regId.equals(</code><code class="java string">""</code><code class="java plain">)) {</code></div><div class="line number75 index74 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Registration is not present, register now with GCM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number76 index75 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GCMRegistrar.register(</code><code class="java keyword">this</code><code class="java plain">, SENDER_ID);</code></div><div class="line number77 index76 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number78 index77 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Device is already registered on GCM</code></div><div class="line number79 index78 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(GCMRegistrar.isRegisteredOnServer(</code><code class="java keyword">this</code><code class="java plain">)) {</code></div><div class="line number80 index79 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Skips registration.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number81 index80 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Toast.makeText(getApplicationContext(), </code><code class="java string">"Already registered with GCM"</code><code class="java plain">, Toast.LENGTH_LONG).show();</code></div><div class="line number82 index81 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number83 index82 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Try to register again, but not in the UI thread.</code></div><div class="line number84 index83 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// It's also necessary to cancel the thread onDestroy(),</code></div><div class="line number85 index84 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// hence the use of AsyncTask instead of a raw thread.</code></div><div class="line number86 index85 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">Context context = </code><code class="java keyword">this</code><code class="java plain">;</code></div><div class="line number87 index86 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mRegisterTask = </code><code class="java keyword">new</code> <code class="java plain">AsyncTask&lt;Void, Void, Void&gt;() {</code></div><div class="line number88 index87 alt1">&nbsp;</div><div class="line number89 index88 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number90 index89 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java plain">Void doInBackground(Void... params) {</code></div><div class="line number91 index90 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Register on our server</code></div><div class="line number92 index91 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// On server creates a new user</code></div><div class="line number93 index92 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ServerUtilities.register(context, name, email, regId);</code></div><div class="line number94 index93 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number95 index94 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number96 index95 alt1">&nbsp;</div><div class="line number97 index96 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number98 index97 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onPostExecute(Void result) {</code></div><div class="line number99 index98 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mRegisterTask = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number100 index99 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number101 index100 alt2">&nbsp;</div><div class="line number102 index101 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number103 index102 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mRegisterTask.execute(</code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">);</code></div><div class="line number104 index103 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number105 index104 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number106 index105 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number107 index106 alt2">&nbsp;</div><div class="line number108 index107 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number109 index108 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Receiving push messages</code></div><div class="line number110 index109 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* */</code></div><div class="line number111 index110 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java plain">BroadcastReceiver mHandleMessageReceiver = </code><code class="java keyword">new</code> <code class="java plain">BroadcastReceiver() {</code></div><div class="line number112 index111 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number113 index112 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onReceive(Context context, Intent intent) {</code></div><div class="line number114 index113 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String newMessage = intent.getExtras().getString(EXTRA_MESSAGE);</code></div><div class="line number115 index114 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Waking up mobile if it is sleeping</code></div><div class="line number116 index115 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">WakeLocker.acquire(getApplicationContext());</code></div><div class="line number117 index116 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number118 index117 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/**</code></div><div class="line number119 index118 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* Take appropriate action on this message</code></div><div class="line number120 index119 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* depending upon your app requirement</code></div><div class="line number121 index120 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* For now i am just displaying it on the screen</code></div><div class="line number122 index121 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">* */</code></div><div class="line number123 index122 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number124 index123 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Showing received message</code></div><div class="line number125 index124 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">lblMessage.append(newMessage + </code><code class="java string">"\n"</code><code class="java plain">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number126 index125 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Toast.makeText(getApplicationContext(), </code><code class="java string">"New Message: "</code> <code class="java plain">+ newMessage, Toast.LENGTH_LONG).show();</code></div><div class="line number127 index126 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number128 index127 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Releasing wake lock</code></div><div class="line number129 index128 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">WakeLocker.release();</code></div><div class="line number130 index129 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number131 index130 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number132 index131 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number133 index132 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number134 index133 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onDestroy() {</code></div><div class="line number135 index134 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(mRegisterTask != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number136 index135 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mRegisterTask.cancel(</code><code class="java keyword">true</code><code class="java plain">);</code></div><div class="line number137 index136 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number138 index137 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number139 index138 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">unregisterReceiver(mHandleMessageReceiver);</code></div><div class="line number140 index139 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GCMRegistrar.onDestroy(</code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number141 index140 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number142 index141 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Log.e(</code><code class="java string">"UnRegister Receiver Error"</code><code class="java plain">, </code><code class="java string">"&gt; "</code> <code class="java plain">+ e.getMessage());</code></div><div class="line number143 index142 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number144 index143 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onDestroy();</code></div><div class="line number145 index144 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number146 index145 alt1">&nbsp;</div><div class="line number147 index146 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p>Now we are done with our android project. Following are the enhancements to enhance the user experience.<br> <br></p><h3>Playing custom notification sound</h3><p>If you want to play custom notification sound, copy your sound file in your project assets folder and write the following code in in <em>private static void generateNotification()</em> function which presents in <em>GCMIntentService.java</em> file.</p><div><div id="highlighter_536800" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">notification.sound = Uri.parse(</code><code class="java string">"android.<a href="resource://">resource://</a>"</code> <code class="java plain">+ context.getPackageName() + </code><code class="java string">"your_sound_file_name.mp3"</code><code class="java plain">);</code></div></div></td></tr></tbody></table></div></div><p><br></p><h3>Vibrating device on receiving new notification</h3><p>If you wan’t to vibrate the device on receiving a new notification add the following lines of code in <em>private static void generateNotification()</em> function which presents in <em>GCMIntentService.java</em> file. Also make sure that you added following permission in <em>AndroidManifest.xml</em> file</p><div><div id="highlighter_749483" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.permission.VIBRATE"</code> <code class="xml plain">/&gt;</code></div></div></td></tr></tbody></table></div></div><div><div id="highlighter_419661" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Vibrate if vibrate is enabled</code></div><div class="line number2 index1 alt1"><code class="java plain">notification.defaults |= Notification.DEFAULT_VIBRATE;</code></div></div></td></tr></tbody></table></div></div><p><br></p><h3>Waking up device on receiving new notification</h3><p>You can also wake the device on receiving new notification if the device is sleeping. Add the following permission in your AndroidManifest.xml file</p><div><div id="highlighter_422565" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">uses-permission</code> <code class="xml color1">android:name</code><code class="xml plain">=</code><code class="xml string">"android.permission.WAKE_LOCK"</code> <code class="xml plain">/&gt;</code></div></div></td></tr></tbody></table></div></div><p>Add a new class file named <em>WakeLocker.java</em> and paste the following code.</p><div><div id="highlighter_585956" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><caption>WakeLocker.java</caption><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.androidhive.pushnotifications;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">android.content.Context;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">android.os.PowerManager;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java keyword">public</code> <code class="java keyword">abstract</code> <code class="java keyword">class</code> <code class="java plain">WakeLocker {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java plain">PowerManager.WakeLock wakeLock;</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">acquire(Context context) {</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(wakeLock != </code><code class="java keyword">null</code><code class="java plain">) wakeLock.release();</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">PowerManager pm = (PowerManager) context.getSystemService(Context.POWER_SERVICE);</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">wakeLock = pm.newWakeLock(PowerManager.FULL_WAKE_LOCK |</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">PowerManager.ACQUIRE_CAUSES_WAKEUP |</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">PowerManager.ON_AFTER_RELEASE, </code><code class="java string">"WakeLock"</code><code class="java plain">);</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">wakeLock.acquire();</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">release() {</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(wakeLock != </code><code class="java keyword">null</code><code class="java plain">) wakeLock.release(); wakeLock = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number22 index21 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p>and call the following lines code in <em>private final BroadcastReceiver mHandleMessageReceiver = new BroadcastReceiver()</em> presents in <em>MainActivity.java</em>.</p><div><div id="highlighter_232578" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Waking up mobile if it is sleeping</code></div><div class="line number2 index1 alt1"><code class="java plain">WakeLocker.acquire(getApplicationContext());</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="java comments">// new message code here</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java comments">// Releasing wake lock</code></div><div class="line number7 index6 alt2"><code class="java plain">WakeLocker.release();</code></div></div></td></tr></tbody></table></div></div><p>Run the project and i’ll be happy to solve the errors if you got any.</p><div style="display: none"> <img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/banner_gcm.png" alt="android google cloud messaging" title="android google cloud messaging" width="166" height="198" class="alignnone size-full wp-image-2451"></div><div class="clear"></div> </article><div class="clearfix"></div> <label class="sharethis">Share this article on</label><ul id="social_big"><li class="first"><script type="text/javascript">var dzone_url = 'http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/';</script><script type="text/javascript">var dzone_title = 'Click to read Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL';</script><script type="text/javascript">var dzone_style = '1';</script><script language="javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/zoneit.js"></script><iframe src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/zoneit.html" height="70" width="50" scrolling="no" frameborder="0"></iframe></li><li><div class="fb-like" data-href="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/" data-width="450" data-layout="box_count" data-show-faces="false" data-send="false"></div></li><li><a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/" data-count="vertical" data-via="RaviTamada #Androidhive" data-text="#Android Push Notifications using #Google Cloud Messaging (GCM), #PHP and #MySQL">Tweet</a></li><li><div id="___plusone_1" style="text-indent: 0px; margin: 0px; padding: 0px; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 50px; height: 60px; background: transparent;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 50px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 60px;" tabindex="0" vspace="0" width="100%" id="I10_1417634474935" name="I10_1417634474935" src="https://apis.google.com/u/0/se/0/_/+1/fastbutton?usegapi=1&size=tall&annotation=bubble&width=300&origin=http%3A%2F%2Fwww.androidhive.info&url=http%3A%2F%2Fwww.androidhive.info%2F2012%2F10%2Fandroid-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql%2F&gsrc=3p&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.9dmnkW-MRCY.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Ft%3Dzcms%2Frs%3DAGLTcCNObFXjcdbTARBNd_5lJHslLoaIfw#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&id=I10_1417634474935&parent=http%3A%2F%2Fwww.androidhive.info&pfname=&rpctoken=33185031" data-gapiattached="true" title="+1"></iframe></div></li><div class="clear"></div></ul><div class="clearfix"></div><div class="wp_rp_wrap  wp_rp_vertical" id="wp_rp_first"><div class="wp_rp_content"><h3 class="related_post_title">You May Also Like</h3><ul class="related_post wp_rp" style="visibility: visible"><li data-position="0" data-poid="in-1154" data-post-type="none"><a href="http://www.androidhive.info/2012/01/android-login-and-registration-with-php-mysql-and-sqlite/" class="wp_rp_thumbnail"><img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/banner_android_php1-150x150.png" alt="Android Login and Registration with PHP, MySQL and SQLite" width="150" height="150"></a><a href="http://www.androidhive.info/2012/01/android-login-and-registration-with-php-mysql-and-sqlite/" class="wp_rp_title">Android Login and Registration with PHP, MySQL and SQLite</a></li><li data-position="1" data-poid="in-4134" data-post-type="none"><a href="http://www.androidhive.info/2014/01/how-to-create-rest-api-for-android-app-using-php-slim-and-mysql-day-12-2/" class="wp_rp_thumbnail"><img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/16.jpg" alt="How to create REST API for Android app using PHP, Slim and MySQL – Day 1/2" width="150" height="150"></a><a href="http://www.androidhive.info/2014/01/how-to-create-rest-api-for-android-app-using-php-slim-and-mysql-day-12-2/" class="wp_rp_title">How to create REST API for Android app using PHP, Slim and MySQL – Day 1/2</a></li><li data-position="2" data-poid="in-2664" data-post-type="none"><a href="http://www.androidhive.info/2013/12/android-populating-spinner-data-from-mysql-database/" class="wp_rp_thumbnail"><img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/6.jpg" alt="Android Populating Spinner data from MySQL Database" width="150" height="150"></a><a href="http://www.androidhive.info/2013/12/android-populating-spinner-data-from-mysql-database/" class="wp_rp_title">Android Populating Spinner data from MySQL Database</a></li><li data-position="3" data-poid="in-1397" data-post-type="none"><a href="http://www.androidhive.info/2012/05/how-to-connect-android-with-php-mysql/" class="wp_rp_thumbnail"><img src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/banner_mysql_php1-150x150.png" alt="How to connect Android with PHP, MySQL" width="150" height="150"></a><a href="http://www.androidhive.info/2012/05/how-to-connect-android-with-php-mysql/" class="wp_rp_title">How to connect Android with PHP, MySQL</a></li></ul></div></div><div class="clear"></div> <br><div id="disqus_thread" data-disqus-shortname="androidhive" data-disqus-url="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/"></div> <br><div class="pagination" style="margin:30px 0 30px 25px;"></div> <br><br><br><br> </section><aside class="sidebar" role="complementary"><div id="profile_new"><div class="profile_pic"></div><div class="profile_meta"> <span>Ravi Tamada</span> <span>Hyderabad, INDIA</span><ul><li class="f"><div class="hover"></div><a href="http://www.facebook.com/ravi8x" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Sidebar&#39;, &#39;Click&#39;, &#39;Home | Facebook&#39;]);"></a></li><li class="t"><div class="hover"></div><a href="http://www.twitter.com/ravitamada" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Sidebar&#39;, &#39;Click&#39;, &#39;Home | Twitter&#39;]);"></a></li><li class="g"><div class="hover"></div><a href="https://plus.google.com/u/0/108738908574182577919/posts" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Sidebar&#39;, &#39;Click&#39;, &#39;Home | GPlus&#39;]);"></a></li><li class="l"><div class="hover"></div><a href="http://in.linkedin.com/pub/ravi-tamada/26/457/a12" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Sidebar&#39;, &#39;Click&#39;, &#39;Home | Linkedin&#39;]);"></a></li><li class="i"><div class="hover"></div><a href="http://instagram.com/ravitamada" target="_blank" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Profile Sidebar&#39;, &#39;Click&#39;, &#39;Home | Instagram&#39;]);" title="Instagram"></a></li></ul></div><div class="clear"></div></div><div class="subscribe_sidebar"><div id="form_sub_hide"> <label class="tagline">Subscribe to get latest updates to your inbox. <br>-- I don’t spam!&nbsp;<img class="img_loader" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/loader.gif" alt="loader"></label><div class="form_container"><form id="form_subscribe" name="subscribe" method="get" action="http://download.androidhive.info/firewall/firewall.php" onsubmit="return false"> <input class="input_email" type="text" name="email" placeholder="Enter your email here"> <input type="hidden" name="flag" value="subscribe_from_site"> <input class="btn_subscribe" type="submit" value="SUBSCRIBE" onclick="subscribeTo();"><div class="clear"></div></form></div></div><div id="subscribe_response"> An email has been sent to your email address. Please verify your account</div><div id="subscribe_response_error"> Please enter valid email address</div></div> <label class="lbl_advertise_sidebar"><a href="http://buysellads.com/buy/detail/111048" target="_blank">Advertise</a></label><div class="side_bar_ad"><div id="bsap_1266299" class="bsarocks bsap_7c32e89b651d1c540f683de3e98dc4a3"></div><div class="clear"></div><div id="bsap_1292381" class="bsarocks bsap_7c32e89b651d1c540f683de3e98dc4a3"></div></div><div class="sidebar_ad_container_300_250"><div id="ad_center_300"><div id="bsap_1289258" class="bsarocks bsap_7c32e89b651d1c540f683de3e98dc4a3"></div></div></div><div class="separator"></div><div class="facebook_likebox"><div class="fb-like-box" data-href="https://www.facebook.com/AndroidHive" data-width="320" data-show-faces="true" data-stream="false" data-show-border="false" data-header="false"></div></div><div class="separator"></div><div class="tag_cloud"> <label>Tag Cloud</label><ul><li><a href="http://www.androidhive.info/category/action-bar/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Action Bar&#39;]);">Action Bar</a></li><li><a href="http://www.androidhive.info/category/adapter/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Adapter&#39;]);">Adapter</a></li><li><a href="http://www.androidhive.info/category/animation/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Animation&#39;]);">Animation</a></li><li><a href="http://www.androidhive.info/category/api/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;API&#39;]);">API</a></li><li><a href="http://www.androidhive.info/category/apps/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Apps&#39;]);">Apps</a></li><li><a href="http://www.androidhive.info/category/async/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Async&#39;]);">Async</a></li><li><a href="http://www.androidhive.info/category/beginner/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Beginner&#39;]);">Beginner</a></li><li><a href="http://www.androidhive.info/category/camera/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Camera&#39;]);">Camera</a></li><li><a href="http://www.androidhive.info/category/chat/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Chat&#39;]);">Chat</a></li><li><a href="http://www.androidhive.info/category/dashboard/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Dashboard&#39;]);">Dashboard</a></li><li><a href="http://www.androidhive.info/category/database/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Database&#39;]);">Database</a></li><li><a href="http://www.androidhive.info/category/facebook/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;facebook&#39;]);">facebook</a></li><li><a href="http://www.androidhive.info/category/fragments/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Fragments&#39;]);">Fragments</a></li><li><a href="http://www.androidhive.info/category/gcm/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;GCM&#39;]);">GCM</a></li><li><a href="http://www.androidhive.info/category/gdk/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;GDK&#39;]);">GDK</a></li><li><a href="http://www.androidhive.info/category/gestures/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Gestures&#39;]);">Gestures</a></li><li><a href="http://www.androidhive.info/category/google/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Google&#39;]);">Google</a></li><li><a href="http://www.androidhive.info/category/google-glass/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Google Glass&#39;]);">Google Glass</a></li><li><a href="http://www.androidhive.info/category/google-plus/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Google Plus&#39;]);">Google Plus</a></li><li><a href="http://www.androidhive.info/category/gps/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;GPS&#39;]);">GPS</a></li><li><a href="http://www.androidhive.info/category/grid/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Grid&#39;]);">Grid</a></li><li><a href="http://www.androidhive.info/category/grid-view/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Grid View&#39;]);">Grid View</a></li><li><a href="http://www.androidhive.info/category/http/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;HTTP&#39;]);">HTTP</a></li><li><a href="http://www.androidhive.info/category/intermediate/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Intermediate&#39;]);">Intermediate</a></li><li><a href="http://www.androidhive.info/category/json/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;json&#39;]);">json</a></li><li><a href="http://www.androidhive.info/category/libstreaming/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Libstreaming&#39;]);">Libstreaming</a></li><li><a href="http://www.androidhive.info/category/list-view/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;List View&#39;]);">List View</a></li><li><a href="http://www.androidhive.info/category/locale/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Locale&#39;]);">Locale</a></li><li><a href="http://www.androidhive.info/category/maps/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Maps&#39;]);">Maps</a></li><li><a href="http://www.androidhive.info/category/mysql/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;MySQL&#39;]);">MySQL</a></li><li><a href="http://www.androidhive.info/category/navigation-drawer/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Navigation Drawer&#39;]);">Navigation Drawer</a></li><li><a href="http://www.androidhive.info/category/php/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;PHP&#39;]);">PHP</a></li><li><a href="http://www.androidhive.info/category/pinch/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Pinch&#39;]);">Pinch</a></li><li><a href="http://www.androidhive.info/category/quick-tips/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Quick Tips&#39;]);">Quick Tips</a></li><li><a href="http://www.androidhive.info/category/rest/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;REST&#39;]);">REST</a></li><li><a href="http://www.androidhive.info/category/sessions/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;sessions&#39;]);">sessions</a></li><li><a href="http://www.androidhive.info/category/slim/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Slim&#39;]);">Slim</a></li><li><a href="http://www.androidhive.info/category/sockets/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Sockets&#39;]);">Sockets</a></li><li><a href="http://www.androidhive.info/category/speech-input/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Speech Input&#39;]);">Speech Input</a></li><li><a href="http://www.androidhive.info/category/spinner/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Spinner&#39;]);">Spinner</a></li><li><a href="http://www.androidhive.info/category/sponsored/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;sponsored&#39;]);">sponsored</a></li><li><a href="http://www.androidhive.info/category/sqlite/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;SQLite&#39;]);">SQLite</a></li><li><a href="http://www.androidhive.info/category/swipe/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Swipe&#39;]);">Swipe</a></li><li><a href="http://www.androidhive.info/category/tab-view/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Tab View&#39;]);">Tab View</a></li><li><a href="http://www.androidhive.info/category/twitter/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Twitter&#39;]);">Twitter</a></li><li><a href="http://www.androidhive.info/category/ui/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;UI&#39;]);">UI</a></li><li><a href="http://www.androidhive.info/category/video/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Video&#39;]);">Video</a></li><li><a href="http://www.androidhive.info/category/video-streaming/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Video Streaming&#39;]);">Video Streaming</a></li><li><a href="http://www.androidhive.info/category/view-pager/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;View Pager&#39;]);">View Pager</a></li><li><a href="http://www.androidhive.info/category/volley/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Volley&#39;]);">Volley</a></li><li><a href="http://www.androidhive.info/category/wearable/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;Wearable&#39;]);">Wearable</a></li><li><a href="http://www.androidhive.info/category/xml/" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Tags Cloud&#39;, &#39;Click&#39;, &#39;xml&#39;]);">xml</a></li></ul><div class="clear"></div></div><div class="separator"></div><div style="width:300px;margin:0 auto;"><div id="___person_0" style="text-indent: 0px; margin: 0px; padding: 0px; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 300px; height: 354px; background: transparent;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 300px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 354px;" tabindex="0" vspace="0" width="100%" id="I11_1417634474988" name="I11_1417634474988" src="https://apis.google.com/u/0/_/widget/render/person?usegapi=1&width=300&href=%2F%2Fplus.google.com%2F108738908574182577919&rel=author&origin=http%3A%2F%2Fwww.androidhive.info&gsrc=3p&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.9dmnkW-MRCY.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Ft%3Dzcms%2Frs%3DAGLTcCNObFXjcdbTARBNd_5lJHslLoaIfw#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&id=I11_1417634474988&parent=http%3A%2F%2Fwww.androidhive.info&pfname=&rpctoken=35698567" data-gapiattached="true" title="+Badge"></iframe></div></div><div class="separator"></div><div class="mp_sidebar"> <label>Most Popular</label><ol class="mp"><li><a href="http://www.androidhive.info/2011/11/android-sqlite-database-tutorial/" title="Android SQLite Database Tutorial">Android SQLite Database Tutorial - 914,356 views</a></li><li><a href="http://www.androidhive.info/2012/05/how-to-connect-android-with-php-mysql/" title="How to connect Android with PHP, MySQL">How to connect Android with PHP, MySQL - 778,951 views</a></li><li><a href="http://www.androidhive.info/2012/01/android-json-parsing-tutorial/" title="Android JSON Parsing Tutorial">Android JSON Parsing Tutorial - 735,353 views</a></li><li><a href="http://www.androidhive.info/2012/02/android-custom-listview-with-image-and-text/" title="Android Custom ListView with Image and Text">Android Custom ListView with Image and Text - 715,067 views</a></li><li><a href="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL.html" title="Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL">Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL - 643,567 views</a></li><li><a href="http://www.androidhive.info/2012/01/android-login-and-registration-with-php-mysql-and-sqlite/" title="Android Login and Registration with PHP, MySQL and SQLite">Android Login and Registration with PHP, MySQL and SQLite - 509,319 views</a></li><li><a href="http://www.androidhive.info/2011/08/android-tab-layout-tutorial/" title="Android Tab Layout Tutorial">Android Tab Layout Tutorial - 436,571 views</a></li><li><a href="http://www.androidhive.info/2013/11/android-sliding-menu-using-navigation-drawer/" title="Android Sliding Menu using Navigation Drawer">Android Sliding Menu using Navigation Drawer - 427,901 views</a></li><li><a href="http://www.androidhive.info/2012/07/android-gps-location-manager-tutorial/" title="Android GPS, Location Manager Tutorial">Android GPS, Location Manager Tutorial - 386,616 views</a></li><li><a href="http://www.androidhive.info/2011/10/android-login-and-registration-screen-design/" title="Android Login and Registration Screen Design">Android Login and Registration Screen Design - 359,472 views</a></li></ol></div><script type="text/javascript">
                    (function() {
                        var po = document.createElement('script');
                        po.type = 'text/javascript';
                        po.async = true;
                        po.src = 'https://apis.google.com/js/plusone.js';
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(po, s);
                    })();
    </script></aside><div class="clear"></div></div><div class="wrapper bottom_ad_container"><div id="ad_bottom_728"><div id="bsap_1289783" class="bsarocks bsap_7c32e89b651d1c540f683de3e98dc4a3"></div></div></div><footer class="footer" role="contentinfo"><div class="footer_info"><div class="wrapper"> Copyright © 2014 AndroidHive. All rights reserved<ul><li><a href="http://www.androidhive.info/advertise-with-us" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Footer Pages&#39;, &#39;Click&#39;, &#39;Advertise | Home Page&#39;]);">Advertise</a></li><li class="sep">.</li><li><a href="http://www.androidhive.info/privacy-policy" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Footer Pages&#39;, &#39;Click&#39;, &#39;Privacy Policy | Home Page&#39;]);">Privacy Policy</a></li><li class="sep">.</li><li><a href="http://www.androidhive.info/terms-of-service" onclick="_gaq.push([&#39;_trackEvent&#39;, &#39;Footer Pages&#39;, &#39;Click&#39;, &#39;Terms of Service | Home Page&#39;]);">Terms &amp; Conditions</a></li></ul></div></div> </footer> <script type="text/javascript">
    (function() {
        var bsa = document.createElement('script');
        bsa.type = 'text/javascript';
        bsa.async = true;
        bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(bsa);
    })();
</script><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/M9QvrswrSazIyEzPyAHiktQiTBFj_eLkosyCkmL94gzn_KJUHUNSdTkVlRZnROTmkKkzuJBcnQEZBWTq9EosSwQA.js"></script><script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://www.androidhive.info/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://www.androidhive.info/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/M9TPS8_Mq9BNzkjMLSgtKtXPKtbPKixNLarUS87Pz85M1cvNzAMA.js"></script><script type="text/javascript">
(function($){
    $("#author").val($.cookie("comment_author_f976b336740ece433af089177fb72471"));
    $("#email").val($.cookie("comment_author_email_f976b336740ece433af089177fb72471"));
    $("#url").val($.cookie("comment_author_url_f976b336740ece433af089177fb72471"));
})(jQuery);
</script> <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script><iframe name="oauth2relay1503950379" id="oauth2relay1503950379" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/postmessageRelay.html" tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe><script type="text/javascript" src="./Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL_files/pinit.js"></script><script type="text/javascript">
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id))
            return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    (function() {
        var po = document.createElement('script');
        po.type = 'text/javascript';
        po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(po, s);
    })();
</script></body></html>